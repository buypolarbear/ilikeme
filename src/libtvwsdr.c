/*
 * tvw-sdr, userspace driver for TVW750 devices
 * Copyright (C) 2012  Joshua Roys <roysjosh@gmail.com>
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 2 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License along
 * with this program; if not, write to the Free Software Foundation, Inc.,
 * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
 */

#include <endian.h>
#include <fcntl.h>
#include <stdint.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <sys/stat.h>
#include <sys/types.h>
#include <time.h>
#include <unistd.h>

#include <libusb.h>

#include "libtvwsdr.h"
#include "tda18271.h"
#include "tvwsdr-compat.h"

#define BULK_TIMEOUT 0

extern struct libusb_device_handle *devh;
static struct dvb_frontend fe;

enum tvwsdr_reg_op {
	REG_READ,
	REG_WRITE,

	REG_AND,
	REG_OR,

	REG_SLEEP,

	/* micro registers at 0x4400 */
	UC_READ,
	UC_WRITE,

	/* ??? */
	E0_MAGIC,

	MAX_REG_OP,
};

struct tvwsdr_reg_cmd {
	enum tvwsdr_reg_op op;
	uint16_t reg;
	uint16_t page;
	uint32_t val;
};

struct tvwsdr_reg_cmd tvw_init1[] = {
	{ REG_READ,  0x0800, 0x2000, 0x00100797 },
	{ REG_WRITE, 0x08a8, 0x2000, 0x0000f0a0 },
	{ REG_WRITE, 0x08ac, 0x2000, 0x0000f0a8 },
	{ REG_WRITE, 0x08b0, 0x2000, 0x0001a008 },
	{ REG_WRITE, 0x08b4, 0x2000, 0x87000024 },
	{ REG_WRITE, 0x08b8, 0x2000, 0x0018c600 },
	{ REG_WRITE, 0x08bc, 0x2000, 0x00c00000 },
	{ REG_WRITE, 0x08c0, 0x2000, 0x00000001 },
	{ REG_WRITE, 0x0938, 0x2000, 0x0001a008 },
	{ REG_WRITE, 0x093c, 0x2000, 0x87000024 },
	{ REG_WRITE, 0x0940, 0x2000, 0x004a6400 },
	{ REG_WRITE, 0x0944, 0x2000, 0x33950000 },
	{ REG_WRITE, 0x0948, 0x2000, 0x000ad437 },
	{ REG_WRITE, 0x0804, 0x2000, 0x008ffb3f },
	{ REG_WRITE, 0x0808, 0x2000, 0x22070155 },
	{ REG_WRITE, 0x080c, 0x2000, 0x00000200 },
	{ REG_READ,  0x080c, 0x2000, 0x00000200 },
	{ REG_WRITE, 0x200c, 0x2000, 0x00600000 },
	{ REG_WRITE, 0x080c, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x080c, 0x2000, 0x00000180 },
	{ REG_READ,  0x080c, 0x2000, 0x00000180 },
	{ REG_WRITE, 0x080c, 0x2000, 0x00000190 },
	{ REG_READ,  0x08b0, 0x2000, 0x0001a008 },
	{ REG_WRITE, 0x08b0, 0x2000, 0x0001a008 },
	{ REG_WRITE, 0x08b0, 0x2000, 0x0001a008 },
	{ REG_READ,  0x08b0, 0x2000, 0x0001a008 },
	{ REG_READ,  0x0938, 0x2000, 0x0001a008 },
	{ REG_WRITE, 0x0938, 0x2000, 0x0001a008 },
	{ REG_WRITE, 0x0938, 0x2000, 0x0001a008 },
	{ REG_WRITE, 0x0000, 0x2000, 0x00000001 },
	{ REG_WRITE, 0x0808, 0x2000, 0x00070155 },
	{ REG_WRITE, 0x0804, 0x2000, 0x00fffa37 },
	{ REG_READ,  0x080c, 0x2000, 0x00000190 },
	{ REG_WRITE, 0x080c, 0x2000, 0x00000180 },
	{ REG_READ,  0x602c, 0x2000, 0x80008000 },
	{ REG_WRITE, 0x602c, 0x2000, 0x80048004 },
	{ REG_WRITE, 0x0820, 0x2000, 0x07ff0000 },
	{ REG_WRITE, 0x088c, 0x2000, 0x0001cfff },
	{ REG_WRITE, 0x0870, 0x2000, 0x07ff0000 },
	{ REG_WRITE, 0x0850, 0x2000, 0x07ff0000 },
	{ REG_WRITE, 0x0884, 0x2000, 0x23ff0000 },
	{ REG_WRITE, 0x0840, 0x2000, 0x07ff0000 },
	{ REG_WRITE, 0x096c, 0x2000, 0x00014eff },
	{ REG_READ,  0x00a8, 0x2000, 0x00000000 },
	{ REG_READ,  0x0800, 0x2000, 0x00100797 },
	{ REG_READ,  0x0800, 0x2000, 0x00100797 },
	{ REG_READ,  0x1844, 0x2000, 0x00bc0000 },
	{ REG_WRITE, 0x1844, 0x2000, 0x00bc0004 },
	{ REG_WRITE, 0x1854, 0x2000, 0x00013400 },
	{ REG_WRITE, 0x1850, 0x2000, 0x00001c00 },
	{ REG_WRITE, 0x1810, 0x2000, 0x00013400 },
	{ REG_WRITE, 0x180c, 0x2000, 0x00001c00 },
	{ REG_WRITE, 0x1a54, 0x2000, 0x00015000 },
	{ REG_WRITE, 0x1a50, 0x2000, 0x00001c00 },
	{ REG_WRITE, 0x1a10, 0x2000, 0x00015000 },
	{ REG_WRITE, 0x1a0c, 0x2000, 0x00001c00 },
	{ REG_READ,  0x1548, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x1548, 0x2000, 0x00001000 },
	{ REG_WRITE, 0x154c, 0x2000, 0x00012400 },
	{ REG_READ,  0x1584, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x1584, 0x2000, 0x00001000 },
	{ REG_WRITE, 0x158c, 0x2000, 0x00001000 },
	{ REG_WRITE, 0x1590, 0x2000, 0x00012400 },
	{ REG_READ,  0x1104, 0x2000, 0x00001010 },
	{ REG_WRITE, 0x1104, 0x2000, 0x00001810 },
	{ REG_WRITE, 0x1184, 0x2000, 0x00000001 },
	{ REG_WRITE, 0x1044, 0x2000, 0x00000012 },
	{ REG_WRITE, 0x112c, 0x2000, 0x00010c00 },
	{ REG_WRITE, 0x114c, 0x2000, 0x00300000 },
	{ REG_READ,  0x1104, 0x2000, 0x00001810 },
	{ REG_WRITE, 0x1104, 0x2000, 0x00001800 },
	{ REG_WRITE, 0x1128, 0x2000, 0x00000003 },
	{ REG_WRITE, 0x1130, 0x2000, 0x00011800 },
	{ REG_WRITE, 0x1150, 0x2000, 0x00300000 },
	{ REG_WRITE, 0x1158, 0x2000, 0x00000000 },
	{ REG_READ,  0x1288, 0x2000, 0x00002040 },
	{ REG_WRITE, 0x1288, 0x2000, 0x00003040 },
	{ REG_WRITE, 0x12a4, 0x2000, 0x00010c00 },
	{ REG_WRITE, 0x12c4, 0x2000, 0x00300000 },
	{ REG_READ,  0x1288, 0x2000, 0x00003040 },
	{ REG_WRITE, 0x1288, 0x2000, 0x00003000 },
	{ REG_WRITE, 0x12a0, 0x2000, 0x00000003 },
	{ REG_WRITE, 0x12a8, 0x2000, 0x00011800 },
	{ REG_WRITE, 0x12c8, 0x2000, 0x00300000 },
	{ REG_WRITE, 0x12d0, 0x2000, 0x00000000 },
	{ REG_READ,  0x009c, 0x2000, 0x00000000 },
	{ REG_READ,  0x0820, 0x2000, 0x07ff0000 },
	{ REG_WRITE, 0x0820, 0x2000, 0x07ff0001 },
	{ REG_WRITE, 0x1214, 0x2000, 0x03ff03ff },
	{ REG_READ,  0x0800, 0x2000, 0x00100797 },
	{ REG_READ,  0x200c, 0x2000, 0x00600000 },
	{ REG_WRITE, 0x200c, 0x2000, 0x00701100 },
	{ REG_WRITE, 0x2014, 0x2000, 0x00100000 },
	{ REG_WRITE, 0x2000, 0x2000, 0x00020002 },
	{ REG_WRITE, 0x2004, 0x2000, 0x000e000e },
	{ REG_WRITE, 0x201c, 0x2000, 0x000f000f },
	{ REG_WRITE, 0x2020, 0x2000, 0x00ff00ff },
	{ REG_READ,  0x1044, 0x2000, 0x00000012 },
	{ REG_WRITE, 0x1044, 0x2000, 0x00000012 },
	{ REG_READ,  0x1044, 0x2000, 0x00000012 },
	{ REG_WRITE, 0x1044, 0x2000, 0x00000012 },
	{ REG_WRITE, 0x0198, 0x2000, 0x01014142 },
	{ REG_READ,  0x019c, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x019c, 0x2000, 0x00000000 },
	{ REG_READ,  0x0194, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x0194, 0x2000, 0x00000000 },
	{ REG_READ,  0x0898, 0x2000, 0x00000400 },
	{ REG_WRITE, 0x0898, 0x2000, 0x00000400 },
	{ REG_READ,  0x08a0, 0x2000, 0x00000400 },
	{ REG_WRITE, 0x08a0, 0x2000, 0x00000400 },
	{ REG_READ,  0x080c, 0x2000, 0x00000180 },
	{ REG_WRITE, 0x080c, 0x2000, 0x00000180 },
	{ REG_READ,  0x0938, 0x2000, 0x0001a008 },
	{ REG_WRITE, 0x0938, 0x2000, 0x0001a01b },
	{ REG_READ,  0x0940, 0x2000, 0x004a6400 },
	{ REG_WRITE, 0x0940, 0x2000, 0x004ad600 },
	{ REG_READ,  0x0944, 0x2000, 0x33950000 },
	{ REG_WRITE, 0x0944, 0x2000, 0x33950000 },
	{ REG_READ,  0x0948, 0x2000, 0x000ad437 },
	{ REG_WRITE, 0x0948, 0x2000, 0x0002dc37 },
	{ REG_READ,  0x0938, 0x2000, 0x0001a01b },
	{ REG_WRITE, 0x0938, 0x2000, 0x0001a00b },
	{ REG_WRITE, 0x0938, 0x2000, 0x0001a008 },
	{ REG_READ,  0x0800, 0x2000, 0x00100797 },
	{ REG_READ,  0x0870, 0x2000, 0x07ff0000 },
	{ REG_WRITE, 0x0870, 0x2000, 0x07ff0000 },
	{ REG_READ,  0x1504, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x1504, 0x2000, 0x00000000 },
	{ REG_READ,  0x080c, 0x2000, 0x00000180 },
	{ REG_WRITE, 0x080c, 0x2000, 0x00000100 },
	{ REG_READ,  0x1a04, 0x2000, 0x00bc0000 },
	{ REG_WRITE, 0x1a04, 0x2000, 0x00bc0000 },
	{ REG_READ,  0x0850, 0x2000, 0x07ff0000 },
	{ REG_WRITE, 0x0850, 0x2000, 0x07ff0001 },
	{ REG_READ,  0x0800, 0x2000, 0x00100797 },
	{ REG_READ,  0x0c04, 0x2000, 0x00004701 },
	{ REG_READ,  0x0c08, 0x2000, 0x00004701 },
	{ REG_READ,  0x0c00, 0x2000, 0x00000006 },
	{ REG_READ,  0x080c, 0x2000, 0x00000100 },
	{ REG_WRITE, 0x080c, 0x2000, 0x00000180 },
	{ REG_READ,  0x080c, 0x2000, 0x00000180 },
	{ REG_WRITE, 0x080c, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x5000, 0x2000, 0x000004c7 },
	{ REG_READ,  0x080c, 0x2000, 0x00000000 },
	{ REG_READ,  0x0800, 0x2000, 0x00100797 },
	{ REG_READ,  0x0800, 0x2000, 0x00100797 },
	{ REG_WRITE, 0x080c, 0x2000, 0x00000000 },
	{ REG_READ,  0x0804, 0x2000, 0x00fffa37 },
	{ REG_WRITE, 0x0804, 0x2000, 0x007ffa35 },
	{ REG_READ,  0x0898, 0x2000, 0x00000400 },
	{ REG_WRITE, 0x0898, 0x2000, 0x00000404 },
	{ REG_READ,  0x08a0, 0x2000, 0x00000400 },
	{ REG_WRITE, 0x08a0, 0x2000, 0x00000404 },
	{ REG_READ,  0x08a8, 0x2000, 0x0000f0a0 },
	{ REG_WRITE, 0x08a8, 0x2000, 0x0000f1a0 },
	{ REG_READ,  0x0804, 0x2000, 0x007ffa35 },
	{ REG_WRITE, 0x0804, 0x2000, 0x00fffa37 },
	{ REG_READ,  0x080c, 0x2000, 0x00000000 },
	{ REG_READ,  0x080c, 0x2000, 0x00000000 },
	{ REG_READ,  0x080c, 0x2000, 0x00000000 },
	{ REG_READ,  0x080c, 0x2000, 0x00000000 },
	{ REG_READ,  0x080c, 0x2000, 0x00000000 },
	{ REG_READ,  0x080c, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x080c, 0x2000, 0x00000000 },
	{ REG_READ,  0x080c, 0x2000, 0x00000000 },
	{ REG_READ,  0x080c, 0x2000, 0x00000000 },
	{ REG_READ,  0x080c, 0x2000, 0x00000000 },
	{ REG_READ,  0x080c, 0x2000, 0x00000000 },
	{ REG_READ,  0x080c, 0x2000, 0x00000000 },
	{ REG_READ,  0x602c, 0x2000, 0x80048004 },
	{ REG_WRITE, 0x602c, 0x2000, 0x80048004 },
	{ REG_WRITE, 0x6860, 0x2000, 0x00004080 },
	{ REG_WRITE, 0x6868, 0x2000, 0x0000000c },
	{ REG_WRITE, 0x61b0, 0x2000, 0x00000580 },
	{ REG_WRITE, 0x6864, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6868, 0x2000, 0x0000020c },
	{ REG_WRITE, 0x686c, 0x2000, 0x00000410 },
	{ REG_WRITE, 0x639c, 0x2000, 0x00000002 },
	{ REG_WRITE, 0x6870, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6874, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6878, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x638c, 0x2000, 0x00001c1a },
	{ REG_WRITE, 0x6390, 0x2000, 0x00000516 },
	{ REG_WRITE, 0x687c, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6880, 0x2000, 0x10000000 },
	{ REG_WRITE, 0x6884, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6888, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x688c, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6144, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x63a0, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x63a4, 0x2000, 0x00000002 },
	{ REG_WRITE, 0x6890, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x616c, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6894, 0x2000, 0xfb000000 },
	{ REG_WRITE, 0x689c, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6168, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x63b8, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x68a0, 0x2000, 0xe8003000 },
	{ REG_WRITE, 0x63bc, 0x2000, 0x00005800 },
	{ REG_WRITE, 0x6394, 0x2000, 0x00008302 },
	{ REG_WRITE, 0x6398, 0x2000, 0x00008070 },
	{ REG_WRITE, 0x6324, 0x2000, 0x00000040 },
	{ REG_READ,  0x0800, 0x2000, 0x00100797 },
	{ REG_READ,  0x0800, 0x2000, 0x00100797 },
	{ REG_WRITE, 0x62d8, 0x2000, 0x81008000 },
	{ REG_WRITE, 0x62dc, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x62e0, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x63c0, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x63f8, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x63fc, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x63f4, 0x2000, 0x00c27f44 },
	{ REG_WRITE, 0x6404, 0x2000, 0x003e0000 },
	{ REG_WRITE, 0x6408, 0x2000, 0x00000007 },
	{ REG_WRITE, 0x6400, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x63e0, 0x2000, 0x00001000 },
	{ REG_WRITE, 0x63cc, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x63c8, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x63c4, 0x2000, 0x00008032 },
	{ REG_WRITE, 0x63a8, 0x2000, 0x87f507f8 },
	{ REG_WRITE, 0x63ac, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x63b0, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x63b4, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x61c0, 0x2000, 0x0fe01000 },
	{ REG_WRITE, 0x61c4, 0x2000, 0x0ff00ff0 },
	{ REG_WRITE, 0x61c8, 0x2000, 0x0fe00000 },
	{ REG_WRITE, 0x68c0, 0x2000, 0x3c000000 },
	{ REG_WRITE, 0x61cc, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x61d0, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x61d4, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x68c4, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x63f0, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6410, 0x2000, 0x00001000 },
	{ REG_WRITE, 0x6414, 0x2000, 0x00001000 },
	{ REG_WRITE, 0x6418, 0x2000, 0x00000020 },
	{ REG_WRITE, 0x6328, 0x2000, 0x10089180 },
	{ REG_WRITE, 0x632c, 0x2000, 0x00000080 },
	{ REG_WRITE, 0x63e4, 0x2000, 0x0e00bf00 },
	{ REG_WRITE, 0x6268, 0x2000, 0x00508650 },
	{ REG_WRITE, 0x63e8, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x61d8, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6320, 0x2000, 0x009320ac },
	{ REG_WRITE, 0x631c, 0x2000, 0x00000280 },
	{ REG_WRITE, 0x6314, 0x2000, 0x000001a3 },
	{ REG_WRITE, 0x6318, 0x2000, 0x02800080 },
	{ REG_WRITE, 0x630c, 0x2000, 0x00100010 },
	{ REG_WRITE, 0x6308, 0x2000, 0xfc3ffc3f },
	{ REG_WRITE, 0x62f0, 0x2000, 0x87000674 },
	{ REG_WRITE, 0x62ec, 0x2000, 0x00000007 },
	{ REG_WRITE, 0x62f4, 0x2000, 0x01010406 },
	{ REG_WRITE, 0x62e8, 0x2000, 0x80c4782e },
	{ REG_WRITE, 0x62e4, 0x2000, 0x000020ac },
	{ REG_WRITE, 0x6310, 0x2000, 0x00100010 },
	{ REG_WRITE, 0x6304, 0x2000, 0x86d016a8 },
	{ REG_WRITE, 0x62fc, 0x2000, 0x00000020 },
	{ REG_WRITE, 0x62f8, 0x2000, 0x04020406 },
	{ REG_WRITE, 0x6300, 0x2000, 0x80c47828 },
	{ REG_WRITE, 0x62bc, 0x2000, 0xe85b281e },
	{ REG_WRITE, 0x62ac, 0x2000, 0xc1850c01 },
	{ REG_WRITE, 0x62b0, 0x2000, 0x02d709d3 },
	{ REG_WRITE, 0x62b4, 0x2000, 0x00007733 },
	{ REG_WRITE, 0x62d4, 0x2000, 0x00000006 },
	{ REG_WRITE, 0x62c0, 0x2000, 0x2030800c },
	{ REG_WRITE, 0x68d0, 0x2000, 0x20000001 },
	{ REG_WRITE, 0x628c, 0x2000, 0x19e72035 },
	{ REG_WRITE, 0x6290, 0x2000, 0x20002000 },
	{ REG_WRITE, 0x68d4, 0x2000, 0x18202000 },
	{ REG_WRITE, 0x6294, 0x2000, 0xffff7800 },
	{ REG_WRITE, 0x6194, 0x2000, 0x01000120 },
	{ REG_WRITE, 0x62b8, 0x2000, 0x02240253 },
	{ REG_WRITE, 0x62c8, 0x2000, 0x0a0a1010 },
	{ REG_WRITE, 0x62cc, 0x2000, 0x04040707 },
	{ REG_WRITE, 0x62d0, 0x2000, 0x0000b000 },
	{ REG_WRITE, 0x62c4, 0x2000, 0x00000022 },
	{ REG_WRITE, 0x6198, 0x2000, 0x0000800b },
	{ REG_WRITE, 0x619c, 0x2000, 0x80810001 },
	{ REG_WRITE, 0x61a0, 0x2000, 0x00006100 },
	{ REG_WRITE, 0x61a4, 0x2000, 0x03000006 },
	{ REG_WRITE, 0x61a8, 0x2000, 0x08000000 },
	{ REG_WRITE, 0x61ac, 0x2000, 0x00000800 },
	{ REG_WRITE, 0x640c, 0x2000, 0x00000011 },
	{ REG_WRITE, 0x68d8, 0x2000, 0x00005022 },
	{ REG_WRITE, 0x641c, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6420, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6424, 0x2000, 0x00001000 },
	{ REG_WRITE, 0x63d0, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x68c8, 0x2000, 0x00004200 },
	{ REG_WRITE, 0x61dc, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x61e0, 0x2000, 0x00740000 },
	{ REG_WRITE, 0x61e4, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x61e8, 0x2000, 0x00000074 },
	{ REG_WRITE, 0x68cc, 0x2000, 0x406d3080 },
	{ REG_WRITE, 0x61ec, 0x2000, 0xfe01008e },
	{ REG_WRITE, 0x61f0, 0x2000, 0x50f030ff },
	{ REG_WRITE, 0x61f4, 0x2000, 0x00800000 },
	{ REG_WRITE, 0x61f8, 0x2000, 0x00200080 },
	{ REG_WRITE, 0x61fc, 0x2000, 0x00328400 },
	{ REG_WRITE, 0x63d4, 0x2000, 0x000b1770 },
	{ REG_WRITE, 0x6200, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6204, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6208, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6164, 0x2000, 0x000002cc },
	{ REG_WRITE, 0x620c, 0x2000, 0x0b0067be },
	{ REG_WRITE, 0x6210, 0x2000, 0x40003fe0 },
	{ REG_WRITE, 0x6214, 0x2000, 0x00700c32 },
	{ REG_WRITE, 0x63d8, 0x2000, 0x00c03020 },
	{ REG_WRITE, 0x63dc, 0x2000, 0x0000003c },
	{ REG_WRITE, 0x6218, 0x2000, 0x40bf3100 },
	{ REG_WRITE, 0x621c, 0x2000, 0x18300140 },
	{ REG_WRITE, 0x6220, 0x2000, 0x00000660 },
	{ REG_WRITE, 0x6224, 0x2000, 0x0000e000 },
	{ REG_WRITE, 0x6228, 0x2000, 0x22220608 },
	{ REG_WRITE, 0x622c, 0x2000, 0x00008e8e },
	{ REG_WRITE, 0x6230, 0x2000, 0x00000002 },
	{ REG_WRITE, 0x6234, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6238, 0x2000, 0x0000b030 },
	{ REG_WRITE, 0x623c, 0x2000, 0x00000080 },
	{ REG_WRITE, 0x6240, 0x2000, 0x091d0020 },
	{ REG_WRITE, 0x6244, 0x2000, 0x00000010 },
	{ REG_WRITE, 0x6248, 0x2000, 0x20000106 },
	{ REG_WRITE, 0x624c, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6250, 0x2000, 0x5000030f },
	{ REG_WRITE, 0x6298, 0x2000, 0x04000100 },
	{ REG_WRITE, 0x629c, 0x2000, 0x01800100 },
	{ REG_WRITE, 0x62a0, 0x2000, 0xff9f0100 },
	{ REG_WRITE, 0x62a4, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6254, 0x2000, 0x00037002 },
	{ REG_WRITE, 0x625c, 0x2000, 0x2f0e2202 },
	{ REG_WRITE, 0x6260, 0x2000, 0x00003def },
	{ REG_WRITE, 0x6264, 0x2000, 0x00204f00 },
	{ REG_WRITE, 0x6898, 0x2000, 0x3820000d },
	{ REG_WRITE, 0x6148, 0x2000, 0x00600040 },
	{ REG_WRITE, 0x614c, 0x2000, 0x40800e40 },
	{ REG_WRITE, 0x6150, 0x2000, 0x01000ecc },
	{ REG_WRITE, 0x6154, 0x2000, 0x08000600 },
	{ REG_WRITE, 0x6158, 0x2000, 0x10000a00 },
	{ REG_WRITE, 0x615c, 0x2000, 0x30002000 },
	{ REG_WRITE, 0x63ec, 0x2000, 0x00000011 },
	{ REG_WRITE, 0x626c, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6270, 0x2000, 0xd7970580 },
	{ REG_WRITE, 0x6274, 0x2000, 0x00005717 },
	{ REG_WRITE, 0x6278, 0x2000, 0x01cc3f3c },
	{ REG_WRITE, 0x627c, 0x2000, 0x000010f0 },
	{ REG_WRITE, 0x6280, 0x2000, 0x2eec80ff },
	{ REG_WRITE, 0x6284, 0x2000, 0x00004942 },
	{ REG_WRITE, 0x6288, 0x2000, 0x00000294 },
	{ REG_WRITE, 0x6258, 0x2000, 0x023a8237 },
	{ REG_WRITE, 0x62a8, 0x2000, 0x0000aa89 },
	{ REG_WRITE, 0x6330, 0x2000, 0x00002098 },
	{ REG_WRITE, 0x6334, 0x2000, 0x83001000 },
	{ REG_WRITE, 0x633c, 0x2000, 0x44444444 },
	{ REG_WRITE, 0x6340, 0x2000, 0xa8644444 },
	{ REG_WRITE, 0x6344, 0x2000, 0x44444444 },
	{ REG_WRITE, 0x6348, 0x2000, 0x4c0000b8 },
	{ REG_WRITE, 0x68e8, 0x2000, 0xf0006200 },
	{ REG_WRITE, 0x634c, 0x2000, 0x0000070c },
	{ REG_WRITE, 0x6160, 0x2000, 0x00ff3040 },
	{ REG_WRITE, 0x6350, 0x2000, 0x80c00c08 },
	{ REG_WRITE, 0x6354, 0x2000, 0x30402000 },
	{ REG_WRITE, 0x6358, 0x2000, 0x4030a010 },
	{ REG_WRITE, 0x6338, 0x2000, 0x40302010 },
	{ REG_WRITE, 0x6364, 0x2000, 0x00001100 },
	{ REG_WRITE, 0x6368, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x636c, 0x2000, 0x05000002 },
	{ REG_WRITE, 0x6428, 0x2000, 0x00000e0e },
	{ REG_WRITE, 0x6370, 0x2000, 0x0000000b },
	{ REG_WRITE, 0x6374, 0x2000, 0x000004fc },
	{ REG_WRITE, 0x642c, 0x2000, 0x02020e00 },
	{ REG_WRITE, 0x6450, 0x2000, 0x39657666 },
	{ REG_WRITE, 0x6430, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6434, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6438, 0x2000, 0x00220000 },
	{ REG_WRITE, 0x643c, 0x2000, 0xffb9ffd6 },
	{ REG_WRITE, 0x6440, 0x2000, 0xff6e00f0 },
	{ REG_WRITE, 0x6444, 0x2000, 0x037afe6e },
	{ REG_WRITE, 0x6448, 0x2000, 0xf88bfef2 },
	{ REG_WRITE, 0x644c, 0x2000, 0x296211df },
	{ REG_WRITE, 0x693c, 0x2000, 0x000002bc },
	{ REG_WRITE, 0x6378, 0x2000, 0x0a030008 },
	{ REG_WRITE, 0x637c, 0x2000, 0x00200010 },
	{ REG_WRITE, 0x6454, 0x2000, 0x00000003 },
	{ REG_WRITE, 0x6940, 0x2000, 0x00000020 },
	{ REG_WRITE, 0x6944, 0x2000, 0x0000000f },
	{ REG_WRITE, 0x6948, 0x2000, 0x27727777 },
	{ REG_WRITE, 0x694c, 0x2000, 0x00004060 },
	{ REG_WRITE, 0x6950, 0x2000, 0x00005090 },
	{ REG_WRITE, 0x6954, 0x2000, 0x000003cc },
	{ REG_WRITE, 0x6958, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6630, 0x2000, 0x00020000 },
	{ REG_WRITE, 0x6c7c, 0x2000, 0x00000590 },
	{ REG_WRITE, 0x6908, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x691c, 0x2000, 0x00000005 },
	{ REG_WRITE, 0x6460, 0x2000, 0x0410fdcf },
	{ REG_WRITE, 0x6464, 0x2000, 0x14401c0a },
	{ REG_WRITE, 0x6468, 0x2000, 0x60404180 },
	{ REG_WRITE, 0x646c, 0x2000, 0x8c28f098 },
	{ REG_WRITE, 0x6470, 0x2000, 0xfc005420 },
	{ REG_WRITE, 0x6474, 0x2000, 0x00137fff },
	{ REG_WRITE, 0x6478, 0x2000, 0xffec0000 },
	{ REG_WRITE, 0x647c, 0x2000, 0x1010f82f },
	{ REG_WRITE, 0x6480, 0x2000, 0x430a4810 },
	{ REG_WRITE, 0x6484, 0x2000, 0xf08c194f },
	{ REG_WRITE, 0x6488, 0x2000, 0x06060200 },
	{ REG_WRITE, 0x648c, 0x2000, 0x06080606 },
	{ REG_WRITE, 0x6490, 0x2000, 0x04380808 },
	{ REG_WRITE, 0x6494, 0x2000, 0x01200120 },
	{ REG_WRITE, 0x6498, 0x2000, 0x03100000 },
	{ REG_WRITE, 0x649c, 0x2000, 0x01200100 },
	{ REG_WRITE, 0x64a0, 0x2000, 0x000204ff },
	{ REG_WRITE, 0x64a4, 0x2000, 0x20f20560 },
	{ REG_WRITE, 0x64a8, 0x2000, 0x304a0a20 },
	{ REG_WRITE, 0x64ac, 0x2000, 0x1e40f20a },
	{ REG_WRITE, 0x64b0, 0x2000, 0x0a404400 },
	{ REG_WRITE, 0x64b4, 0x2000, 0x2832423c },
	{ REG_WRITE, 0x64b8, 0x2000, 0xff404100 },
	{ REG_WRITE, 0x64bc, 0x2000, 0x050e4000 },
	{ REG_WRITE, 0x64c0, 0x2000, 0x7010020e },
	{ REG_WRITE, 0x64c4, 0x2000, 0x0a085000 },
	{ REG_WRITE, 0x64c8, 0x2000, 0x64648440 },
	{ REG_WRITE, 0x64cc, 0x2000, 0x8b000240 },
	{ REG_WRITE, 0x64d0, 0x2000, 0x04b41eb4 },
	{ REG_WRITE, 0x64d4, 0x2000, 0x58ff2000 },
	{ REG_WRITE, 0x64d8, 0x2000, 0x20640650 },
	{ REG_WRITE, 0x64dc, 0x2000, 0x00392064 },
	{ REG_WRITE, 0x64e0, 0x2000, 0x019a01ea },
	{ REG_WRITE, 0x64e4, 0x2000, 0x004005fa },
	{ REG_WRITE, 0x64f4, 0x2000, 0x817a400a },
	{ REG_WRITE, 0x64f8, 0x2000, 0x06406040 },
	{ REG_WRITE, 0x64fc, 0x2000, 0x009b0000 },
	{ REG_WRITE, 0x65cc, 0x2000, 0x00000f68 },
	{ REG_WRITE, 0x65d0, 0x2000, 0x28000000 },
	{ REG_WRITE, 0x65d4, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x65d8, 0x2000, 0xfffff000 },
	{ REG_WRITE, 0x65dc, 0x2000, 0x11302020 },
	{ REG_WRITE, 0x65e0, 0x2000, 0x000a0a0a },
	{ REG_WRITE, 0x66cc, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x66d0, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x66d4, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x66d8, 0x2000, 0x0f802f00 },
	{ REG_WRITE, 0x66dc, 0x2000, 0x4a001f80 },
	{ REG_WRITE, 0x66e0, 0x2000, 0x00000a0a },
	{ REG_WRITE, 0x66e4, 0x2000, 0x14001400 },
	{ REG_WRITE, 0x6500, 0x2000, 0x7c0081be },
	{ REG_WRITE, 0x6504, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6508, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x650c, 0x2000, 0x0e1c0000 },
	{ REG_WRITE, 0x6510, 0x2000, 0x3b80ffff },
	{ REG_WRITE, 0x6514, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6518, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x651c, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6520, 0x2000, 0x000f0000 },
	{ REG_WRITE, 0x6524, 0x2000, 0xffff2440 },
	{ REG_WRITE, 0x6528, 0x2000, 0x0000ff00 },
	{ REG_WRITE, 0x652c, 0x2000, 0xffffffff },
	{ REG_WRITE, 0x6530, 0x2000, 0x00ff0000 },
	{ REG_WRITE, 0x6534, 0x2000, 0x20802020 },
	{ REG_WRITE, 0x6538, 0x2000, 0x40c64040 },
	{ REG_WRITE, 0x653c, 0x2000, 0x0000c280 },
	{ REG_WRITE, 0x6540, 0x2000, 0x10101410 },
	{ REG_WRITE, 0x6544, 0x2000, 0x8f781058 },
	{ REG_WRITE, 0x6548, 0x2000, 0xf532146f },
	{ REG_WRITE, 0x654c, 0x2000, 0x1e1e241e },
	{ REG_WRITE, 0x6550, 0x2000, 0x8e8108b7 },
	{ REG_WRITE, 0x6554, 0x2000, 0xf8319999 },
	{ REG_WRITE, 0x6558, 0x2000, 0xd562b06c },
	{ REG_WRITE, 0x655c, 0x2000, 0xdc826001 },
	{ REG_WRITE, 0x6560, 0x2000, 0x28124f3d },
	{ REG_WRITE, 0x6564, 0x2000, 0x0998cf2b },
	{ REG_WRITE, 0x6568, 0x2000, 0xf1f54b1b },
	{ REG_WRITE, 0x656c, 0x2000, 0x3c32ef3d },
	{ REG_WRITE, 0x6570, 0x2000, 0xa9983320 },
	{ REG_WRITE, 0x6574, 0x2000, 0x34d9433e },
	{ REG_WRITE, 0x6578, 0x2000, 0x1fa39825 },
	{ REG_WRITE, 0x657c, 0x2000, 0x4a9e522b },
	{ REG_WRITE, 0x6580, 0x2000, 0x5cfb4e7b },
	{ REG_WRITE, 0x6584, 0x2000, 0x2452d0c3 },
	{ REG_WRITE, 0x6588, 0x2000, 0xea9efd2b },
	{ REG_WRITE, 0x658c, 0x2000, 0xd8f051db },
	{ REG_WRITE, 0x6590, 0x2000, 0x8020bf3d },
	{ REG_WRITE, 0x6594, 0x2000, 0x14188025 },
	{ REG_WRITE, 0x6598, 0x2000, 0x0d601c1f },
	{ REG_WRITE, 0x659c, 0x2000, 0x20000240 },
	{ REG_WRITE, 0x65a0, 0x2000, 0x88888888 },
	{ REG_WRITE, 0x65a4, 0x2000, 0x88887888 },
	{ REG_WRITE, 0x65a8, 0x2000, 0x88886788 },
	{ REG_WRITE, 0x65ac, 0x2000, 0x56780004 },
	{ REG_WRITE, 0x65b0, 0x2000, 0x45680023 },
	{ REG_WRITE, 0x65b4, 0x2000, 0x23460002 },
	{ REG_WRITE, 0x65b8, 0x2000, 0x12350001 },
	{ REG_WRITE, 0x65bc, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x65c0, 0x2000, 0x44030a05 },
	{ REG_WRITE, 0x65e4, 0x2000, 0x70002050 },
	{ REG_WRITE, 0x65e8, 0x2000, 0x08608300 },
	{ REG_WRITE, 0x65ec, 0x2000, 0x28144000 },
	{ REG_WRITE, 0x65f0, 0x2000, 0x28142800 },
	{ REG_WRITE, 0x65f4, 0x2000, 0x14288000 },
	{ REG_WRITE, 0x65f8, 0x2000, 0x70f0001f },
	{ REG_WRITE, 0x660c, 0x2000, 0x0a283e40 },
	{ REG_WRITE, 0x6610, 0x2000, 0xbe100b38 },
	{ REG_WRITE, 0x6614, 0x2000, 0x04ff1010 },
	{ REG_WRITE, 0x6618, 0x2000, 0x08467f57 },
	{ REG_WRITE, 0x661c, 0x2000, 0x0a603032 },
	{ REG_WRITE, 0x6620, 0x2000, 0x10080b20 },
	{ REG_WRITE, 0x6638, 0x2000, 0x000027fd },
	{ REG_WRITE, 0x663c, 0x2000, 0x00000008 },
	{ REG_WRITE, 0x6640, 0x2000, 0x000007f0 },
	{ REG_WRITE, 0x6644, 0x2000, 0x0000001d },
	{ REG_WRITE, 0x6648, 0x2000, 0x000007cd },
	{ REG_WRITE, 0x664c, 0x2000, 0x00000064 },
	{ REG_WRITE, 0x6650, 0x2000, 0x020006bd },
	{ REG_WRITE, 0x6654, 0x2000, 0x07d80003 },
	{ REG_WRITE, 0x6658, 0x2000, 0x001107f3 },
	{ REG_WRITE, 0x665c, 0x2000, 0x0009001e },
	{ REG_WRITE, 0x6660, 0x2000, 0x07da07dc },
	{ REG_WRITE, 0x6664, 0x2000, 0x00530018 },
	{ REG_WRITE, 0x6668, 0x2000, 0x07920032 },
	{ REG_WRITE, 0x666c, 0x2000, 0x028606d2 },
	{ REG_WRITE, 0x6670, 0x2000, 0xc8c802c8 },
	{ REG_WRITE, 0x6674, 0x2000, 0x000014a7 },
	{ REG_WRITE, 0x6678, 0x2000, 0x80001460 },
	{ REG_WRITE, 0x667c, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6680, 0x2000, 0x00010000 },
	{ REG_WRITE, 0x6690, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6694, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6698, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x669c, 0x2000, 0x00080000 },
	{ REG_WRITE, 0x66a0, 0x2000, 0x112a0028 },
	{ REG_WRITE, 0x66a4, 0x2000, 0x00440e58 },
	{ REG_WRITE, 0x66a8, 0x2000, 0x80be2204 },
	{ REG_WRITE, 0x66ac, 0x2000, 0x04042cb4 },
	{ REG_WRITE, 0x66b0, 0x2000, 0x00000ac3 },
	{ REG_WRITE, 0x66b4, 0x2000, 0x61500000 },
	{ REG_WRITE, 0x66b8, 0x2000, 0x64304180 },
	{ REG_WRITE, 0x66bc, 0x2000, 0xa028a028 },
	{ REG_WRITE, 0x66c0, 0x2000, 0x001402ff },
	{ REG_WRITE, 0x66c4, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x65c4, 0x2000, 0x8f7f12f0 },
	{ REG_WRITE, 0x65c8, 0x2000, 0x00b13b34 },
	{ REG_WRITE, 0x6b74, 0x2000, 0x00000043 },
	{ REG_WRITE, 0x6b78, 0x2000, 0x00036fc8 },
	{ REG_WRITE, 0x6b7c, 0x2000, 0x00041eaf },
	{ REG_WRITE, 0x6b80, 0x2000, 0x0006df91 },
	{ REG_WRITE, 0x6b88, 0x2000, 0x00083d5f },
	{ REG_WRITE, 0x6b8c, 0x2000, 0x0000800f },
	{ REG_WRITE, 0x6b54, 0x2000, 0x00000110 },
	{ REG_WRITE, 0x6b58, 0x2000, 0x00040400 },
	{ REG_WRITE, 0x6940, 0x2000, 0x00000020 },
	{ REG_WRITE, 0x6908, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6974, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6978, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6780, 0x2000, 0x003f0003 },
	{ REG_WRITE, 0x6abc, 0x2000, 0x0c000202 },
	{ REG_WRITE, 0x66f4, 0x2000, 0xf0080c00 },
	{ REG_WRITE, 0x66f8, 0x2000, 0x070b0008 },
	{ REG_WRITE, 0x60a0, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6700, 0x2000, 0x00000001 },
	{ REG_WRITE, 0x697c, 0x2000, 0x00000001 },
	{ REG_WRITE, 0x6ac4, 0x2000, 0x00000001 },
	{ REG_WRITE, 0x6ac0, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6708, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x670c, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6710, 0x2000, 0xf8000000 },
	{ REG_WRITE, 0x6714, 0x2000, 0x00003d78 },
	{ REG_WRITE, 0x6718, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x671c, 0x2000, 0xffffffff },
	{ REG_WRITE, 0x68a4, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6ae8, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6ad0, 0x2000, 0x02000200 },
	{ REG_WRITE, 0x6ad4, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6ad8, 0x2000, 0x02000200 },
	{ REG_WRITE, 0x6adc, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6ae0, 0x2000, 0x02000200 },
	{ REG_WRITE, 0x6ae4, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6aec, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6af0, 0x2000, 0x07f80000 },
	{ REG_WRITE, 0x6af4, 0x2000, 0x00001000 },
	{ REG_WRITE, 0x6af8, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6afc, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6b00, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6b04, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6a10, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6a14, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6a18, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6a1c, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6a20, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6a58, 0x2000, 0x00000004 },
	{ REG_WRITE, 0x6a24, 0x2000, 0x0000001c },
	{ REG_WRITE, 0x6a28, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6a2c, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6a30, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6a40, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6a44, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6a48, 0x2000, 0x00000003 },
	{ REG_WRITE, 0x6b08, 0x2000, 0x00008000 },
	{ REG_WRITE, 0x6a4c, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6a50, 0x2000, 0x07380060 },
	{ REG_WRITE, 0x6a54, 0x2000, 0x0000063c },
	{ REG_WRITE, 0x6a5c, 0x2000, 0x000000c0 },
	{ REG_WRITE, 0x6a60, 0x2000, 0x00000200 },
	{ REG_WRITE, 0x6a64, 0x2000, 0xc1220000 },
	{ REG_WRITE, 0x6a68, 0x2000, 0x93281c00 },
	{ REG_WRITE, 0x6a6c, 0x2000, 0x608f0000 },
	{ REG_WRITE, 0x6a70, 0x2000, 0x00000a00 },
	{ REG_WRITE, 0x6a74, 0x2000, 0xeca86420 },
	{ REG_WRITE, 0x6a78, 0x2000, 0x00001040 },
	{ REG_WRITE, 0x6a7c, 0x2000, 0x01f40023 },
	{ REG_WRITE, 0x6a80, 0x2000, 0x00000032 },
	{ REG_WRITE, 0x6a84, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6a88, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x68f0, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6a9c, 0x2000, 0x00200000 },
	{ REG_WRITE, 0x6aa0, 0x2000, 0x38080010 },
	{ REG_WRITE, 0x6aa4, 0x2000, 0x0038022f },
	{ REG_WRITE, 0x6aa8, 0x2000, 0x00003038 },
	{ REG_WRITE, 0x6ab0, 0x2000, 0x00001020 },
	{ REG_WRITE, 0x6ab4, 0x2000, 0x00800040 },
	{ REG_WRITE, 0x6ab8, 0x2000, 0x010000c0 },
	{ REG_WRITE, 0x6068, 0x2000, 0x00000080 },
	{ REG_WRITE, 0x68f8, 0x2000, 0x00000006 },
	{ REG_WRITE, 0x68a8, 0x2000, 0x00002000 },
	{ REG_WRITE, 0x696c, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6938, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6b50, 0x2000, 0x01000700 },
	{ REG_WRITE, 0x6b20, 0x2000, 0x000000a6 },
	{ REG_WRITE, 0x6b28, 0x2000, 0x000000e4 },
	{ REG_WRITE, 0x6b24, 0x2000, 0x000000e4 },
	{ REG_READ,  0x6904, 0x2000, 0xe40f000f },
	{ REG_WRITE, 0x6904, 0x2000, 0xe400100f },
	{ REG_READ,  0x6010, 0x2000, 0x000306aa },
	{ REG_WRITE, 0x6010, 0x2000, 0x000306aa },
	{ REG_READ,  0x6018, 0x2000, 0x000206aa },
	{ REG_WRITE, 0x6018, 0x2000, 0x000206aa },
	{ REG_WRITE, 0x6068, 0x2000, 0x00000080 },
	{ REG_READ,  0x605c, 0x2000, 0x00030003 },
	{ REG_WRITE, 0x605c, 0x2000, 0x00020003 },
	{ REG_READ,  0x6040, 0x2000, 0x00100010 },
	{ REG_WRITE, 0x6040, 0x2000, 0x01000100 },
	{ REG_READ,  0x6044, 0x2000, 0x00010001 },
	{ REG_WRITE, 0x6044, 0x2000, 0x01000100 },
	{ REG_WRITE, 0x604c, 0x2000, 0x00000001 },
	{ REG_WRITE, 0x6050, 0x2000, 0x00000079 },
	{ REG_WRITE, 0x6054, 0x2000, 0x00005ceb },
	{ REG_WRITE, 0x6058, 0x2000, 0x001c001c },
	{ REG_WRITE, 0x6c1c, 0x2000, 0x0002a25a },
	{ REG_WRITE, 0x6cac, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6cb0, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6cb4, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6cb8, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6cbc, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6cc0, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6cc4, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6cc8, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6ccc, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6cd0, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6cd4, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6cd8, 0x2000, 0x00001001 },
	{ REG_WRITE, 0x6cdc, 0x2000, 0x00009009 },
	{ REG_WRITE, 0x6ce0, 0x2000, 0x00f3cf3c },
	{ REG_WRITE, 0x6ce4, 0x2000, 0x0013b13b },
	{ REG_WRITE, 0x6ce8, 0x2000, 0x00161161 },
	{ REG_WRITE, 0x6cec, 0x2000, 0x0043c43c },
	{ REG_WRITE, 0x6c7c, 0x2000, 0x00001d90 },
	{ REG_WRITE, 0x6cf0, 0x2000, 0x03008740 },
	{ REG_WRITE, 0x6c5c, 0x2000, 0x0f1a8080 },
	{ REG_WRITE, 0x6c78, 0x2000, 0x20202cc0 },
	{ REG_READ,  0x6ca0, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6ca0, 0x2000, 0x00000003 },
	{ REG_WRITE, 0x6c8c, 0x2000, 0xff0000ff },
	{ REG_WRITE, 0x6c90, 0x2000, 0xffffffff },
	{ REG_WRITE, 0x6cf4, 0x2000, 0x676780d0 },
	{ REG_READ,  0x0800, 0x2000, 0x00100797 },
	{ REG_READ,  0x0800, 0x2000, 0x00100797 },
	{ REG_READ,  0x6ad4, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6ad4, 0x2000, 0x00000000 },
	{ REG_READ,  0x6ad0, 0x2000, 0x02000200 },
	{ REG_WRITE, 0x6ad0, 0x2000, 0x02000200 },
	{ REG_READ,  0x6a90, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6a90, 0x2000, 0x00000000 },
	{ REG_READ,  0x6ae0, 0x2000, 0x02000200 },
	{ REG_READ,  0x6ad8, 0x2000, 0x02000200 },
	{ REG_WRITE, 0x6ae0, 0x2000, 0x02000200 },
	{ REG_WRITE, 0x6ad8, 0x2000, 0x02000200 },
	{ REG_READ,  0x68f0, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x68f0, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x6b3c, 0x2000, 0x00000022 },
	{ REG_READ,  0x6b40, 0x2000, 0x03e803e8 },
	{ REG_WRITE, 0x6b40, 0x2000, 0x03e803e8 },
	{ REG_WRITE, 0x6b44, 0x2000, 0x1b2f806b },
	{ REG_READ,  0x0000, 0x2000, 0x00000001 },
	{ REG_WRITE, 0x0000, 0x2000, 0x00000001 },
	{ REG_READ,  0x0804, 0x2000, 0x00fffa37 },
	{ REG_WRITE, 0x0804, 0x2000, 0x00fffa37 },
	{ REG_READ,  0x0804, 0x2000, 0x00fffa37 },
	{ REG_READ,  0x0808, 0x2000, 0x00070155 },
	{ REG_WRITE, 0x0804, 0x2000, 0x00fffa37 },
	{ REG_READ,  0x0804, 0x2000, 0x00fffa37 },
	{ REG_READ,  0x0808, 0x2000, 0x00070155 },
	{ REG_READ,  0x0800, 0x2000, 0x00100797 },
	{ REG_READ,  0x0800, 0x2000, 0x00100797 },
	{ REG_WRITE, 0x0804, 0x2000, 0x00fffa37 },
	{ REG_READ,  0x08b0, 0x2000, 0x0001a008 },
	{ REG_READ,  0x08b4, 0x2000, 0x87000024 },
	{ REG_READ,  0x08b8, 0x2000, 0x0018c600 },
	{ REG_READ,  0x08bc, 0x2000, 0x00c00000 },
	{ REG_READ,  0x08c0, 0x2000, 0x00000001 },
	{ REG_READ,  0x08c4, 0x2000, 0x000000a8 },
	{ REG_READ,  0x0938, 0x2000, 0x0001a008 },
	{ REG_READ,  0x093c, 0x2000, 0x87000024 },
	{ REG_READ,  0x0940, 0x2000, 0x004ad600 },
	{ REG_READ,  0x0944, 0x2000, 0x33950000 },
	{ REG_READ,  0x0948, 0x2000, 0x0002dc37 },
	{ REG_READ,  0x094c, 0x2000, 0x000000a8 },
	{ REG_READ,  0x0870, 0x2000, 0x07ff0000 },
	{ REG_WRITE, 0x0870, 0x2000, 0x07ff0000 },
	{ REG_READ,  0x0804, 0x2000, 0x00fffa37 },
	{ REG_READ,  0x0808, 0x2000, 0x00070155 },
	{ REG_WRITE, 0x0804, 0x2000, 0x00fffa30 },
	{ REG_READ,  0x0804, 0x2000, 0x00fffa30 },
	{ REG_READ,  0x0808, 0x2000, 0x00070155 },
	{ REG_READ,  0x0804, 0x2000, 0x00fffa30 },
	{ REG_WRITE, 0x0804, 0x2000, 0x00ffda30 },
	{ REG_READ,  0x0804, 0x2000, 0x00ffda30 },
	{ REG_WRITE, 0x0804, 0x2000, 0x00ff5a30 },
	{ REG_READ,  0x0804, 0x2000, 0x00ff5a30 },
	{ REG_READ,  0x0808, 0x2000, 0x00070155 },
	{ REG_READ,  0x0800, 0x2000, 0x00100797 },

	{ .op = MAX_REG_OP },
};

struct tvwsdr_reg_cmd tvw_init2[] = {
	{ REG_WRITE, 0xe000, 0x1000, 0x00000050 },
	{ REG_READ,  0x0228, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x0228, 0x2000, 0x0000033e },
	{ REG_READ,  0x0224, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x0224, 0x2000, 0x0000000c },
	{ REG_READ,  0x0224, 0x2000, 0x0000000c },
	{ REG_WRITE, 0x0224, 0x2000, 0x0000000c },
	{ REG_READ,  0x0820, 0x2000, 0x07ff0001 },
	{ REG_WRITE, 0x0820, 0x2000, 0x07ff0001 },
	{ REG_READ,  0x0800, 0x2000, 0x00100797 },

	{ .op = MAX_REG_OP },
};

/* Register 0x4400 appears to be some sort of communication with a micro.
 * To read something from it, write 0x40XXYYZZ to 0x4400 where XXYY is the
 * register (which seems to start at 0xf000) and ZZ is 0x00.  Then, read
 * from 0x4400.  XXYY will be the same data written previously, but ZZ will
 * be the register's contents.
 * To write something, write 0x80XXYYZZ where XXYY is as before, but ZZ is
 * the data to write.
 */

struct tvwsdr_reg_cmd tvw_init3[] = {
	{ REG_READ,  0x0224, 0x2000, 0x0000000c },
	{ REG_WRITE, 0x0224, 0x2000, 0x0000000c },
	{ REG_READ,  0x08f8, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x08f8, 0x2000, 0x00000000 },
	{ REG_READ,  0x0894, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x0894, 0x2000, 0xa01f0000 },
	{ REG_READ,  0x0898, 0x2000, 0x00000404 },
	{ REG_WRITE, 0x0898, 0x2000, 0x000f8524 },
	{ REG_READ,  0x089c, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x089c, 0x2000, 0x001f0000 },
	{ REG_READ,  0x08a0, 0x2000, 0x00000404 },
	{ REG_WRITE, 0x08a0, 0x2000, 0x020f853e },
	{ UC_WRITE,  0xf008,      0,       0xff },
	{ UC_WRITE,  0xf009,      0,       0x7f },
	{ UC_WRITE,  0xf00a,      0,       0xdf },
	{ UC_WRITE,  0xf101,      0,       0x00 },
	{ UC_READ,   0xf00d,      0,       0x00 },
	{ UC_WRITE,  0xf00d,      0,       0xff },
	{ UC_READ,   0xf00b,      0,       0x00 },
	{ UC_WRITE,  0xf00b,      0,       0xc0 },
	{ UC_READ,   0xf301,      0,       0x00 },
	{ UC_WRITE,  0xf301,      0,       0x1f },
	{ UC_WRITE,  0xf00e,      0,       0x80 },
	{ UC_WRITE,  0xf01a,      0,       0xff },
	{ UC_WRITE,  0xf01b,      0,       0xfc },
	{ UC_WRITE,  0xf01e,      0,       0xff },
	{ UC_READ,   0xf02b,      0,       0x30 },
	{ UC_WRITE,  0xf02b,      0,       0x30 },
	{ UC_READ,   0xf00b,      0,       0xc0 },
	{ UC_WRITE,  0xf00b,      0,       0xc0 },
	{ UC_WRITE,  0xf008,      0,       0x50 },
	{ UC_WRITE,  0xf009,      0,       0x00 },
	{ UC_WRITE,  0xf00a,      0,       0x00 },
	{ UC_READ,   0xf02b,      0,       0x30 },
	{ UC_WRITE,  0xf02b,      0,       0x20 },
	{ UC_READ,   0xf00b,      0,       0xc0 },
	{ UC_WRITE,  0xf00b,      0,       0x80 },
	{ UC_READ,   0xf00d,      0,       0xff },
	{ UC_WRITE,  0xf00d,      0,       0x9f },
	{ UC_READ,   0xf00d,      0,       0x9f },
	{ UC_WRITE,  0xf00d,      0,       0xff },
	{ UC_READ,   0xf00c,      0,       0x00 },
	{ UC_WRITE,  0xf00c,      0,       0x07 },
	{ UC_READ,   0xf00b,      0,       0x80 },
	{ UC_WRITE,  0xf00b,      0,       0xc0 },
	{ UC_READ,   0xf00d,      0,       0xff },
	{ UC_WRITE,  0xf00d,      0,       0x00 },
	{ UC_READ,   0xf00c,      0,       0x07 },
	{ UC_WRITE,  0xf00c,      0,       0x00 },
	{ UC_READ,   0xf00b,      0,       0xc0 },
	{ UC_WRITE,  0xf00b,      0,       0x00 },
	{ UC_READ,   0xf089,      0,       0x80 },
	{ UC_WRITE,  0xf089,      0,       0x80 },
	{ UC_WRITE,  0xf09f,      0,       0x00 },
	{ REG_SLEEP,      0,      0,         10 },
	{ UC_WRITE,  0xf09c,      0,       0x00 },
	{ UC_WRITE,  0xf09d,      0,       0x00 },
	{ UC_WRITE,  0xf09e,      0,       0x00 },
	{ UC_WRITE,  0xf02a,      0,       0x40 },
	{ UC_WRITE,  0xf081,      0,       0x00 },
	{ UC_WRITE,  0xf082,      0,       0x00 },
	{ UC_WRITE,  0xf083,      0,       0x00 },
	{ UC_WRITE,  0xf084,      0,       0x00 },
	{ UC_WRITE,  0xf085,      0,       0x00 },
	{ UC_WRITE,  0xf086,      0,       0x00 },
	{ UC_WRITE,  0xf090,      0,       0x00 },
	{ UC_WRITE,  0xf091,      0,       0x00 },
	{ UC_WRITE,  0xf092,      0,       0x00 },
	{ UC_WRITE,  0xf093,      0,       0x00 },
	{ UC_WRITE,  0xf094,      0,       0x00 },
	{ UC_WRITE,  0xf095,      0,       0x00 },
	{ UC_WRITE,  0xf096,      0,       0x00 },

	{ .op = MAX_REG_OP },
};

struct tvwsdr_reg_cmd tvw_init4[] = {
	{ UC_READ,   0xf02a,      0,       0x40 },
	{ UC_WRITE,  0xf02a,      0,       0x00 },
	{ UC_READ,   0xf09f,      0,       0x00 },
	/* 0x8e1a is T507.bin fw size */
	{ UC_WRITE,  0xf0a0,      0,       0x8e },
	{ UC_WRITE,  0xf0a1,      0,       0x1a },
	{ UC_WRITE,  0xf0a2,      0,       0xef },
	{ UC_WRITE,  0xf0a3,      0,       0x36 },
	{ UC_WRITE,  0xf09f,      0,       0xbc },
	{ UC_READ,   0xf089,      0,       0x80 },
	{ UC_WRITE,  0xf089,      0,       0x00 },
	{ REG_SLEEP,      0,      0,        100 },
	{ UC_READ,   0xf09c,      0,       0xbc },
	{ UC_WRITE,  0xf09c,      0,       0x00 },
	{ UC_READ,   0xf09f,      0,       0x3c },
	{ UC_READ,   0xf00b,      0,       0x00 },
	{ UC_WRITE,  0xf00b,      0,       0x00 },
	{ UC_READ,   0xf00b,      0,       0x00 },
	{ UC_WRITE,  0xf00b,      0,       0x00 },
	{ UC_READ,   0xf024,      0,       0x80 },
	{ UC_WRITE,  0xf024,      0,       0x00 },
	{ UC_READ,   0xf024,      0,       0x00 },
	{ UC_READ,   0xf025,      0,       0x04 },
	{ UC_READ,   0xf026,      0,       0x17 },
	{ UC_READ,   0xf09f,      0,       0x3c },
	{ UC_WRITE,  0xf0a0,      0,       0x0c },
	{ UC_WRITE,  0xf0a1,      0,       0x00 },
	{ UC_WRITE,  0xf09f,      0,       0x9c },
	{ REG_SLEEP,      0,      0,         10 },
	{ UC_READ,   0xf09c,      0,       0x9c },
	{ UC_WRITE,  0xf09c,      0,       0x00 },
	{ UC_READ,   0xf09f,      0,       0x1c },
	{ UC_READ,   0xf09f,      0,       0x1c },
	{ UC_WRITE,  0xf0a0,      0,       0x0d },
	{ UC_WRITE,  0xf0a1,      0,       0x00 },
	{ UC_WRITE,  0xf09f,      0,       0x9c },
	{ REG_SLEEP,      0,      0,         10 },
	{ UC_READ,   0xf09c,      0,       0x9c },
	{ UC_WRITE,  0xf09c,      0,       0x00 },
	{ UC_READ,   0xf09f,      0,       0x1c },
	{ UC_READ,   0xf09f,      0,       0x1c },
	{ UC_WRITE,  0xf0a0,      0,       0x0e },
	{ UC_WRITE,  0xf0a1,      0,       0x00 },
	{ UC_WRITE,  0xf09f,      0,       0x9c },
	{ REG_SLEEP,      0,      0,         10 },
	{ UC_READ,   0xf09c,      0,       0x9c },
	{ UC_WRITE,  0xf09c,      0,       0x00 },
	{ UC_READ,   0xf09f,      0,       0x1c },
	{ UC_READ,   0xf09f,      0,       0x1c },
	{ UC_WRITE,  0xf0a0,      0,       0x0f },
	{ UC_WRITE,  0xf0a1,      0,       0x00 },
	{ UC_WRITE,  0xf09f,      0,       0x9c },
	{ REG_SLEEP,      0,      0,         10 },
	{ UC_READ,   0xf09c,      0,       0x9c },
	{ UC_WRITE,  0xf09c,      0,       0x00 },
	{ UC_READ,   0xf09f,      0,       0x1c },
	{ UC_READ,   0xf09f,      0,       0x1c },
	{ UC_WRITE,  0xf0a0,      0,       0x10 },
	{ UC_WRITE,  0xf0a1,      0,       0x00 },
	{ UC_WRITE,  0xf09f,      0,       0x9c },
	{ REG_SLEEP,      0,      0,         10 },
	{ UC_READ,   0xf09c,      0,       0x9c },
	{ UC_WRITE,  0xf09c,      0,       0x00 },
	{ UC_READ,   0xf09f,      0,       0x1c },
	{ UC_READ,   0xf09f,      0,       0x1c },
	{ UC_WRITE,  0xf0a0,      0,       0x11 },
	{ UC_WRITE,  0xf0a1,      0,       0x00 },
	{ UC_WRITE,  0xf09f,      0,       0x9c },
	{ REG_SLEEP,      0,      0,         10 },
	{ UC_READ,   0xf09c,      0,       0x9c },
	{ UC_WRITE,  0xf09c,      0,       0x00 },
	{ UC_READ,   0xf09f,      0,       0x1c },
	{ UC_READ,   0xf09f,      0,       0x1c },
	{ UC_WRITE,  0xf0a0,      0,       0x12 },
	{ UC_WRITE,  0xf0a1,      0,       0x00 },
	{ UC_WRITE,  0xf09f,      0,       0x9c },
	{ REG_SLEEP,      0,      0,         10 },
	{ UC_READ,   0xf09c,      0,       0x9c },
	{ UC_WRITE,  0xf09c,      0,       0x00 },
	{ UC_READ,   0xf09f,      0,       0x1c },
	{ UC_READ,   0xf09f,      0,       0x1c },
	{ UC_WRITE,  0xf0a0,      0,       0x13 },
	{ UC_WRITE,  0xf0a1,      0,       0x00 },
	{ UC_WRITE,  0xf09f,      0,       0x9c },
	{ REG_SLEEP,      0,      0,         10 },
	{ UC_READ,   0xf09c,      0,       0x9c },
	{ UC_WRITE,  0xf09c,      0,       0x00 },
	{ UC_READ,   0xf09f,      0,       0x1c },
	{ UC_READ,   0xf09f,      0,       0x1c },
	{ UC_WRITE,  0xf0a0,      0,       0x14 },
	{ UC_WRITE,  0xf0a1,      0,       0x00 },
	{ UC_WRITE,  0xf09f,      0,       0x9c },
	{ REG_SLEEP,      0,      0,         10 },
	{ UC_READ,   0xf09c,      0,       0x9c },
	{ UC_WRITE,  0xf09c,      0,       0x00 },
	{ UC_READ,   0xf09f,      0,       0x1c },
	{ UC_READ,   0xf09f,      0,       0x1c },
	{ UC_WRITE,  0xf0a0,      0,       0x15 },
	{ UC_WRITE,  0xf0a1,      0,       0x00 },
	{ UC_WRITE,  0xf09f,      0,       0x9c },
	{ REG_SLEEP,      0,      0,         10 },
	{ UC_READ,   0xf09c,      0,       0x9c },
	{ UC_WRITE,  0xf09c,      0,       0x00 },
	{ UC_READ,   0xf09f,      0,       0x1c },
	{ UC_READ,   0xf09f,      0,       0x1c },
	{ UC_WRITE,  0xf0a0,      0,       0x16 },
	{ UC_WRITE,  0xf0a1,      0,       0x00 },
	{ UC_WRITE,  0xf09f,      0,       0x9c },
	{ REG_SLEEP,      0,      0,         10 },
	{ UC_READ,   0xf09c,      0,       0x9c },
	{ UC_WRITE,  0xf09c,      0,       0x00 },
	{ UC_READ,   0xf09f,      0,       0x1c },
	{ UC_READ,   0xf09f,      0,       0x1c },
	{ UC_WRITE,  0xf0a0,      0,       0x17 },
	{ UC_WRITE,  0xf0a1,      0,       0x00 },
	{ UC_WRITE,  0xf09f,      0,       0x9c },
	{ REG_SLEEP,      0,      0,         10 },
	{ UC_READ,   0xf09c,      0,       0x9c },
	{ UC_WRITE,  0xf09c,      0,       0x00 },
	{ UC_READ,   0xf09f,      0,       0x1c },
	{ UC_READ,   0xf09f,      0,       0x1c },
	{ UC_WRITE,  0xf0a0,      0,       0x18 },
	{ UC_WRITE,  0xf0a1,      0,       0x00 },
	{ UC_WRITE,  0xf09f,      0,       0x9c },
	{ REG_SLEEP,      0,      0,         10 },
	{ UC_READ,   0xf09c,      0,       0x9c },
	{ UC_WRITE,  0xf09c,      0,       0x00 },
	{ UC_READ,   0xf09f,      0,       0x1c },
	{ UC_READ,   0xf09f,      0,       0x1c },
	{ UC_WRITE,  0xf0a0,      0,       0x0c },
	{ UC_WRITE,  0xf0a1,      0,       0x01 },
	{ UC_WRITE,  0xf0a2,      0,       0xc2 },
	{ UC_WRITE,  0xf0a3,      0,       0x60 },
	{ UC_WRITE,  0xf09f,      0,       0x9c },
	{ REG_SLEEP,      0,      0,         10 },
	{ UC_READ,   0xf09c,      0,       0x9c },
	{ UC_WRITE,  0xf09c,      0,       0x00 },
	{ UC_READ,   0xf09f,      0,       0x1c },
	{ UC_READ,   0xf09f,      0,       0x1c },
	{ UC_WRITE,  0xf0a0,      0,       0x0d },
	{ UC_WRITE,  0xf0a1,      0,       0x01 },
	{ UC_WRITE,  0xf0a2,      0,       0xc2 },
	{ UC_WRITE,  0xf0a3,      0,       0x60 },
	{ UC_WRITE,  0xf09f,      0,       0x9c },
	{ REG_SLEEP,      0,      0,         10 },
	{ UC_READ,   0xf09c,      0,       0x9c },
	{ UC_WRITE,  0xf09c,      0,       0x00 },
	{ UC_READ,   0xf09f,      0,       0x1c },
	{ UC_READ,   0xf09f,      0,       0x1c },
	{ UC_WRITE,  0xf0a0,      0,       0x0e },
	{ UC_WRITE,  0xf0a1,      0,       0x01 },
	{ UC_WRITE,  0xf0a2,      0,       0xc2 },
	{ UC_WRITE,  0xf0a3,      0,       0x60 },
	{ UC_WRITE,  0xf09f,      0,       0x9c },
	{ REG_SLEEP,      0,      0,         10 },
	{ UC_READ,   0xf09c,      0,       0x9c },
	{ UC_WRITE,  0xf09c,      0,       0x00 },
	{ UC_READ,   0xf09f,      0,       0x1c },
	{ UC_READ,   0xf09f,      0,       0x1c },
	{ UC_WRITE,  0xf0a0,      0,       0x1d },
	{ UC_WRITE,  0xf0a1,      0,       0x07 },
	{ UC_WRITE,  0xf0a2,      0,       0xc2 },
	{ UC_WRITE,  0xf0a3,      0,       0x60 },
	{ UC_WRITE,  0xf0a4,      0,       0xd7 },
	{ UC_WRITE,  0xf0a5,      0,       0x07 },
	{ UC_WRITE,  0xf0a6,      0,       0xc8 },
	{ UC_WRITE,  0xf0a7,      0,       0x22 },
	{ UC_WRITE,  0xf0a8,      0,       0xd5 },
	{ UC_WRITE,  0xf0a9,      0,       0x33 },
	{ UC_WRITE,  0xf0aa,      0,       0xc6 },
	{ UC_WRITE,  0xf0ab,      0,       0x35 },
	{ UC_WRITE,  0xf0ac,      0,       0xcd },
	{ UC_WRITE,  0xf0ad,      0,       0x15 },
	{ UC_WRITE,  0xf0ae,      0,       0xc3 },
	{ UC_WRITE,  0xf0af,      0,       0x04 },
	{ UC_WRITE,  0xf09f,      0,       0x9c },
	{ REG_SLEEP,      0,      0,         10 },
	{ UC_READ,   0xf09c,      0,       0x9c },
	{ UC_WRITE,  0xf09c,      0,       0x00 },
	{ UC_READ,   0xf09f,      0,       0x1c },
	{ UC_READ,   0xf09f,      0,       0x1c },
	{ UC_WRITE,  0xf0a0,      0,       0x1e },
	{ UC_WRITE,  0xf0a1,      0,       0x04 },
	{ UC_WRITE,  0xf0a2,      0,       0xd5 },
	{ UC_WRITE,  0xf0a3,      0,       0x00 },
	{ UC_WRITE,  0xf0a4,      0,       0xc6 },
	{ UC_WRITE,  0xf0a5,      0,       0x00 },
	{ UC_WRITE,  0xf0a6,      0,       0xcd },
	{ UC_WRITE,  0xf0a7,      0,       0x00 },
	{ UC_WRITE,  0xf0a8,      0,       0xc3 },
	{ UC_WRITE,  0xf0a9,      0,       0x00 },
	{ UC_WRITE,  0xf09f,      0,       0x9c },
	{ REG_SLEEP,      0,      0,         10 },
	{ UC_READ,   0xf09c,      0,       0x9c },
	{ UC_WRITE,  0xf09c,      0,       0x00 },
	{ UC_READ,   0xf09f,      0,       0x1c },
	{ UC_READ,   0xf09f,      0,       0x1c },
	{ UC_WRITE,  0xf0a0,      0,       0x0f },
	{ UC_WRITE,  0xf0a1,      0,       0x01 },
	{ UC_WRITE,  0xf0a2,      0,       0xc2 },
	{ UC_WRITE,  0xf0a3,      0,       0x60 },
	{ UC_WRITE,  0xf09f,      0,       0x9c },
	{ REG_SLEEP,      0,      0,         10 },
	{ UC_READ,   0xf09c,      0,       0x9c },
	{ UC_WRITE,  0xf09c,      0,       0x00 },
	{ UC_READ,   0xf09f,      0,       0x1c },
	{ UC_READ,   0xf09f,      0,       0x1c },
	{ UC_WRITE,  0xf0a0,      0,       0x1f },
	{ UC_WRITE,  0xf0a1,      0,       0x07 },
	{ UC_WRITE,  0xf0a2,      0,       0xc2 },
	{ UC_WRITE,  0xf0a3,      0,       0x60 },
	{ UC_WRITE,  0xf0a4,      0,       0xd7 },
	{ UC_WRITE,  0xf0a5,      0,       0x07 },
	{ UC_WRITE,  0xf0a6,      0,       0xc8 },
	{ UC_WRITE,  0xf0a7,      0,       0x22 },
	{ UC_WRITE,  0xf0a8,      0,       0xd5 },
	{ UC_WRITE,  0xf0a9,      0,       0x33 },
	{ UC_WRITE,  0xf0aa,      0,       0xc6 },
	{ UC_WRITE,  0xf0ab,      0,       0x35 },
	{ UC_WRITE,  0xf0ac,      0,       0xcd },
	{ UC_WRITE,  0xf0ad,      0,       0x15 },
	{ UC_WRITE,  0xf0ae,      0,       0xc3 },
	{ UC_WRITE,  0xf0af,      0,       0x04 },
	{ UC_WRITE,  0xf09f,      0,       0x9c },
	{ REG_SLEEP,      0,      0,         10 },
	{ UC_READ,   0xf09c,      0,       0x9c },
	{ UC_WRITE,  0xf09c,      0,       0x00 },
	{ UC_READ,   0xf09f,      0,       0x1c },
	{ UC_READ,   0xf09f,      0,       0x1c },
	{ UC_WRITE,  0xf0a0,      0,       0x20 },
	{ UC_WRITE,  0xf0a1,      0,       0x04 },
	{ UC_WRITE,  0xf0a2,      0,       0xd5 },
	{ UC_WRITE,  0xf0a3,      0,       0x00 },
	{ UC_WRITE,  0xf0a4,      0,       0xc6 },
	{ UC_WRITE,  0xf0a5,      0,       0x00 },
	{ UC_WRITE,  0xf0a6,      0,       0xcd },
	{ UC_WRITE,  0xf0a7,      0,       0x00 },
	{ UC_WRITE,  0xf0a8,      0,       0xc3 },
	{ UC_WRITE,  0xf0a9,      0,       0x00 },
	{ UC_WRITE,  0xf09f,      0,       0x9c },
	{ REG_SLEEP,      0,      0,         10 },
	{ UC_READ,   0xf09c,      0,       0x9c },
	{ UC_WRITE,  0xf09c,      0,       0x00 },
	{ UC_READ,   0xf09f,      0,       0x1c },
	{ UC_READ,   0xf09f,      0,       0x1c },
	{ UC_WRITE,  0xf0a0,      0,       0x10 },
	{ UC_WRITE,  0xf0a1,      0,       0x01 },
	{ UC_WRITE,  0xf0a2,      0,       0xc2 },
	{ UC_WRITE,  0xf0a3,      0,       0x60 },
	{ UC_WRITE,  0xf09f,      0,       0x9c },
	{ REG_SLEEP,      0,      0,         10 },
	{ UC_READ,   0xf09c,      0,       0x9c },
	{ UC_WRITE,  0xf09c,      0,       0x00 },
	{ UC_READ,   0xf09f,      0,       0x1c },
	{ UC_READ,   0xf09f,      0,       0x1c },
	{ UC_WRITE,  0xf0a0,      0,       0x21 },
	{ UC_WRITE,  0xf0a1,      0,       0x07 },
	{ UC_WRITE,  0xf0a2,      0,       0xc2 },
	{ UC_WRITE,  0xf0a3,      0,       0x60 },
	{ UC_WRITE,  0xf0a4,      0,       0xd7 },
	{ UC_WRITE,  0xf0a5,      0,       0x07 },
	{ UC_WRITE,  0xf0a6,      0,       0xc8 },
	{ UC_WRITE,  0xf0a7,      0,       0x22 },
	{ UC_WRITE,  0xf0a8,      0,       0xd5 },
	{ UC_WRITE,  0xf0a9,      0,       0x33 },
	{ UC_WRITE,  0xf0aa,      0,       0xc6 },
	{ UC_WRITE,  0xf0ab,      0,       0x35 },
	{ UC_WRITE,  0xf0ac,      0,       0xcd },
	{ UC_WRITE,  0xf0ad,      0,       0x15 },
	{ UC_WRITE,  0xf0ae,      0,       0xc3 },
	{ UC_WRITE,  0xf0af,      0,       0x04 },
	{ UC_WRITE,  0xf09f,      0,       0x9c },
	{ REG_SLEEP,      0,      0,         10 },
	{ UC_READ,   0xf09c,      0,       0x9c },
	{ UC_WRITE,  0xf09c,      0,       0x00 },
	{ UC_READ,   0xf09f,      0,       0x1c },
	{ UC_READ,   0xf09f,      0,       0x1c },
	{ UC_WRITE,  0xf0a0,      0,       0x22 },
	{ UC_WRITE,  0xf0a1,      0,       0x04 },
	{ UC_WRITE,  0xf0a2,      0,       0xd5 },
	{ UC_WRITE,  0xf0a3,      0,       0x00 },
	{ UC_WRITE,  0xf0a4,      0,       0xc6 },
	{ UC_WRITE,  0xf0a5,      0,       0x00 },
	{ UC_WRITE,  0xf0a6,      0,       0xcd },
	{ UC_WRITE,  0xf0a7,      0,       0x00 },
	{ UC_WRITE,  0xf0a8,      0,       0xc3 },
	{ UC_WRITE,  0xf0a9,      0,       0x00 },
	{ UC_WRITE,  0xf09f,      0,       0x9c },
	{ REG_SLEEP,      0,      0,         10 },
	{ UC_READ,   0xf09c,      0,       0x9c },
	{ UC_WRITE,  0xf09c,      0,       0x00 },
	{ UC_READ,   0xf09f,      0,       0x1c },
	{ UC_READ,   0xf09f,      0,       0x1c },
	{ UC_WRITE,  0xf0a0,      0,       0x03 },
	{ UC_WRITE,  0xf0a1,      0,       0x01 },
	{ UC_WRITE,  0xf0a2,      0,       0x32 },
	{ UC_WRITE,  0xf0a3,      0,       0x18 },
	{ UC_WRITE,  0xf0a4,      0,       0x6a },
	{ UC_WRITE,  0xf0a5,      0,       0x18 },
	{ UC_WRITE,  0xf0a6,      0,       0x6a },
	{ UC_WRITE,  0xf0a7,      0,       0x18 },
	{ UC_WRITE,  0xf0a8,      0,       0x6a },
	{ UC_WRITE,  0xf0a9,      0,       0x18 },
	{ UC_WRITE,  0xf0aa,      0,       0x6a },
	{ UC_WRITE,  0xf09f,      0,       0x9c },
	{ REG_SLEEP,      0,      0,         10 },
	{ UC_READ,   0xf09c,      0,       0x9c },
	{ UC_WRITE,  0xf09c,      0,       0x00 },
	{ UC_READ,   0xf09f,      0,       0x1c },
	{ UC_READ,   0xf117,      0,       0xc1 },
	{ UC_WRITE,  0xf117,      0,       0x71 },
	{ UC_READ,   0xf00e,      0,       0x80 },
	{ UC_WRITE,  0xf00e,      0,       0x00 },
	{ UC_READ,   0xf00f,      0,       0x00 },
	{ UC_WRITE,  0xf00f,      0,       0x18 },
	{ UC_READ,   0xf480,      0,       0x00 },
	{ UC_WRITE,  0xf480,      0,       0x00 },
	{ UC_READ,   0xf00d,      0,       0x00 },
	{ UC_WRITE,  0xf00d,      0,       0x10 },
	{ UC_WRITE,  0xf00d,      0,       0x00 },
	{ UC_READ,   0xf480,      0,       0x00 },
	{ UC_WRITE,  0xf480,      0,       0x0c },
	{ UC_WRITE,  0xf481,      0,       0x00 },
	{ UC_WRITE,  0xf48d,      0,       0x00 },
	{ UC_WRITE,  0xf482,      0,       0x80 },
	{ UC_WRITE,  0xf483,      0,       0x00 },
	{ UC_WRITE,  0xf484,      0,       0x00 },
	{ UC_WRITE,  0xf488,      0,       0x06 },
	{ UC_WRITE,  0xf48c,      0,       0x00 },
	{ UC_WRITE,  0xf48b,      0,       0x00 },
	{ UC_READ,   0xf480,      0,       0x0c },
	{ UC_WRITE,  0xf480,      0,       0x4c },
	{ REG_READ,  0x08f8, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x08f8, 0x2000, 0x00000000 },
	{ REG_READ,  0x0894, 0x2000, 0xa01f0000 },
	{ REG_WRITE, 0x0894, 0x2000, 0xa01f0000 },
	{ REG_READ,  0x0898, 0x2000, 0x000f8524 },
	{ REG_WRITE, 0x0898, 0x2000, 0x000f8524 },
	{ REG_READ,  0x089c, 0x2000, 0x001f0000 },
	{ REG_WRITE, 0x089c, 0x2000, 0x001f0000 },
	{ REG_READ,  0x08a0, 0x2000, 0x020f853e },
	{ REG_WRITE, 0x08a0, 0x2000, 0x020f853e },
	{ UC_READ,   0xf00d,      0,       0x00 },
	{ UC_WRITE,  0xf00d,      0,       0x01 },
	{ UC_WRITE,  0xf00d,      0,       0x00 },
	{ REG_WRITE, 0x0850, 0x2000, 0x07ff0000 },
	{ REG_WRITE, 0x102c, 0x2000, 0x00000001 },
	{ UC_WRITE,  0xf0b2,      0,       0x00 },
	{ UC_WRITE,  0xf0b3,      0,       0x00 },
	{ UC_WRITE,  0xf0b4,      0,       0x00 },
	{ UC_WRITE,  0xf0b5,      0,       0x00 },
	{ UC_READ,   0xf00b,      0,       0x00 },
	{ UC_WRITE,  0xf00b,      0,       0x40 },
	{ UC_WRITE,  0xf00b,      0,       0x00 },
	{ UC_READ,   0xf02b,      0,       0x00 },
	{ UC_WRITE,  0xf02b,      0,       0x00 },
	{ UC_READ,   0xf00d,      0,       0x00 },
	{ UC_WRITE,  0xf00d,      0,       0x01 },
	{ UC_WRITE,  0xf00d,      0,       0x00 },
	{ UC_WRITE,  0xf00d,      0,       0x02 },
	{ UC_WRITE,  0xf00d,      0,       0x00 },
	{ UC_READ,   0xf09f,      0,       0x1c },
	{ UC_WRITE,  0xf0a0,      0,       0xe2 },
	{ UC_WRITE,  0xf0a1,      0,       0xed },
	{ UC_WRITE,  0xf0a2,      0,       0x8b },
	{ UC_WRITE,  0xf0a3,      0,       0x9b },
	{ UC_WRITE,  0xf0a4,      0,       0x00 },
	{ UC_WRITE,  0xf09f,      0,       0x9a },
	{ REG_SLEEP,      0,      0,         10 },
	{ UC_READ,   0xf09c,      0,       0x9a },
	{ UC_WRITE,  0xf09c,      0,       0x00 },
	{ UC_READ,   0xf09f,      0,       0x1a },
	{ UC_WRITE,  0xf101,      0,       0x00 },
	{ UC_WRITE,  0xf100,      0,       0x00 },
	{ UC_WRITE,  0xf117,      0,       0x07 },
	{ UC_WRITE,  0xf11c,      0,       0x00 },
	{ UC_WRITE,  0xf11d,      0,       0x00 },
	{ UC_WRITE,  0xf106,      0,       0x00 },
	{ UC_WRITE,  0xf10d,      0,       0x00 },
	{ UC_WRITE,  0xf103,      0,       0x00 },
	{ UC_WRITE,  0xf102,      0,       0x60 },
	{ UC_WRITE,  0xf101,      0,       0x04 },
	{ UC_READ,   0xf09f,      0,       0x1a },
	{ UC_WRITE,  0xf0a0,      0,       0x01 },
	{ UC_WRITE,  0xf0a1,      0,       0x02 },
	{ UC_WRITE,  0xf0a2,      0,       0x00 },
	{ UC_WRITE,  0xf09f,      0,       0x9c },
	{ REG_SLEEP,      0,      0,         10 },
	{ UC_READ,   0xf09c,      0,       0x9c },
	{ UC_WRITE,  0xf09c,      0,       0x00 },
	{ UC_READ,   0xf09f,      0,       0x1c },
	{ UC_READ,   0xf480,      0,       0x6c },
	{ UC_WRITE,  0xf480,      0,       0x2c },
	{ UC_READ,   0xf00d,      0,       0x00 },
	{ UC_WRITE,  0xf00d,      0,       0x10 },
	{ UC_WRITE,  0xf00d,      0,       0x00 },
	{ UC_READ,   0xf480,      0,       0x00 },
	{ UC_WRITE,  0xf480,      0,       0x04 },
	{ UC_WRITE,  0xf481,      0,       0x00 },
	{ UC_WRITE,  0xf48d,      0,       0x00 },
	{ UC_WRITE,  0xf482,      0,       0x80 },
	{ UC_WRITE,  0xf483,      0,       0x00 },
	{ UC_WRITE,  0xf484,      0,       0x00 },
	{ UC_WRITE,  0xf488,      0,       0x00 },
	{ UC_WRITE,  0xf48c,      0,       0x00 },
	{ UC_WRITE,  0xf48b,      0,       0x00 },
	{ UC_READ,   0xf480,      0,       0x04 },
	{ UC_WRITE,  0xf480,      0,       0x44 },
	{ UC_WRITE,  0xf090,      0,       0x80 },
	{ REG_SLEEP,      0,      0,         10 },
	{ UC_READ,   0xf091,      0,       0x80 },
	{ UC_WRITE,  0xf063,      0,       0x01 },
	{ UC_WRITE,  0xf101,      0,       0x04 },
	{ REG_READ,  0x0804, 0x2000, 0x00ff5a30 },
	{ REG_WRITE, 0x0804, 0x2000, 0x00ff5a30 },

	{ .op = MAX_REG_OP },
};

struct tvwsdr_reg_cmd tvw_init5[] = {
	{ REG_READ,  0x08b0, 0x2000, 0x0001a008 },
	{ REG_READ,  0x08b4, 0x2000, 0x87000024 },
	{ REG_READ,  0x08b8, 0x2000, 0x0018c600 },
	{ REG_READ,  0x08bc, 0x2000, 0x00c00000 },
	{ REG_READ,  0x08c0, 0x2000, 0x00000001 },
	{ REG_READ,  0x08c4, 0x2000, 0x000000a8 },
	{ REG_READ,  0x0938, 0x2000, 0x0001a008 },
	{ REG_READ,  0x093c, 0x2000, 0x87000024 },
	{ REG_READ,  0x0940, 0x2000, 0x004ad600 },
	{ REG_READ,  0x0944, 0x2000, 0x33950000 },
	{ REG_READ,  0x0948, 0x2000, 0x0002dc37 },
	{ REG_READ,  0x094c, 0x2000, 0x000000a8 },
	{ REG_READ,  0x0870, 0x2000, 0x07ff0000 },
	{ REG_WRITE, 0x0870, 0x2000, 0x07ff0000 },
	{ REG_READ,  0x0804, 0x2000, 0x00ff5a30 },
	{ REG_READ,  0x0808, 0x2000, 0x00070155 },
	{ REG_WRITE, 0x0804, 0x2000, 0x00ff5a30 },
	{ REG_READ,  0x0804, 0x2000, 0x00ff5a30 },
	{ REG_READ,  0x0808, 0x2000, 0x00070155 },
	{ REG_READ,  0x0870, 0x2000, 0x07ff0000 },
	{ REG_WRITE, 0x0870, 0x2000, 0x07ff0000 },
	{ REG_READ,  0x0938, 0x2000, 0x0001a008 },
	{ REG_WRITE, 0x0938, 0x2000, 0x0001a108 },
	{ REG_WRITE, 0x08e0, 0x2000, 0x000cdfe5 },
	{ REG_WRITE, 0x08e4, 0x2000, 0x000176ff },
	{ REG_WRITE, 0x08e8, 0x2000, 0x28800880 },
	{ REG_READ,  0x0224, 0x2000, 0x0000000c },
	{ REG_WRITE, 0x0224, 0x2000, 0x0000000c },
	{ REG_READ,  0x0224, 0x2000, 0x0000000c },
	{ REG_WRITE, 0x0224, 0x2000, 0x0000000c },
	{ REG_READ,  0x0870, 0x2000, 0x07ff0000 },
	{ REG_WRITE, 0x0870, 0x2000, 0x07ff0002 },
	{ REG_READ,  0x0938, 0x2000, 0x0001a108 },
	{ REG_WRITE, 0x0938, 0x2000, 0x0001a108 },
	{ REG_WRITE, 0x08e0, 0x2000, 0x000cdfe5 },
	{ REG_WRITE, 0x08e4, 0x2000, 0x000176ff },
	{ REG_WRITE, 0x08e8, 0x2000, 0x28800880 },
	{ REG_READ,  0x0834, 0x2000, 0x00000080 },
	{ REG_READ,  0x0800, 0x2000, 0x00100797 },
	{ REG_READ,  0x0800, 0x2000, 0x00100797 },
	{ REG_READ,  0x0800, 0x2000, 0x00100797 },
	{ REG_READ,  0x0800, 0x2000, 0x00100797 },
	{ REG_READ,  0x0804, 0x2000, 0x00ff5a30 },
	{ REG_WRITE, 0x0804, 0x2000, 0x00ff5a30 },
	{ E0_MAGIC,       0,      0, 0x00000151 },
	{ REG_WRITE, 0x0808, 0x2000, 0x20070154 },
	{ REG_WRITE, 0x0938, 0x2000, 0x0001a119 },
	{ UC_WRITE,  0xf00d,      0,       0xe0 },
	{ UC_WRITE,  0xf00c,      0,       0x07 },
	{ REG_WRITE, 0x0804, 0x2000, 0x001f8a30 },
	{ REG_READ,  0x0804, 0x2000, 0x001f8a30 },
	{ REG_READ,  0x0804, 0x2000, 0x001f8a30 },
	{ REG_READ,  0x0804, 0x2000, 0x001f8a30 },
	{ REG_READ,  0x08ac, 0x2000, 0x0000f0a8 },
	{ REG_WRITE, 0x08ac, 0x2000, 0x0000f0a0 },
	{ REG_READ,  0x00f0, 0x2000, 0x05030209 },
	{ REG_WRITE, 0x00f0, 0x2000, 0x05ff0209 },
	{ REG_READ,  0x00fc, 0x2000, 0x00000000 },
	{ REG_WRITE, 0x00fc, 0x2000, 0x00000000 },
	{ REG_READ,  0x0804, 0x2000, 0x001f8a30 },
	{ REG_READ,  0x0804, 0x2000, 0x001f8a30 },
	{ REG_READ,  0x0804, 0x2000, 0x001f8a30 },

	{ .op = MAX_REG_OP },
}; // ati_00.pcap 35902

void
tvwsdr_msleep(int msecs) {
	struct timespec ts;

	ts.tv_sec = 0;
	ts.tv_nsec = msecs * 1000 * 1000;

	nanosleep(&ts, NULL);
}

int
tvwsdr_read_reg(uint16_t reg, uint16_t page, void *buf, uint16_t len) {
	int ret, n_read;
	uint16_t flags = 0x0000, len_le, rlen = len;
	unsigned char tmpbuf[12] = {0};

	/* ugly hack for one register read following the firmware upload */
	if (reg == 0x0000 && page == 0x8000 && len == 0x0000) {
		flags = 0xbfc1;
		rlen = 4;
	}

	reg = htole16(reg);
	page = htole16(page);
	len_le = htole16(len);
	flags = htole16(flags);
	memcpy(tmpbuf + 0, &reg, 2);
	memcpy(tmpbuf + 2, &page, 2);
	memcpy(tmpbuf + 4, &len_le, 2);
	memcpy(tmpbuf + 6, &flags, 2);
	tmpbuf[7] |= (1 << 7);
	reg = ~reg;
	page = ~page;
	memcpy(tmpbuf + 8, &reg, 2);
	memcpy(tmpbuf + 10, &page, 2);

	/* write offset */
	ret = libusb_bulk_transfer(devh, 0x03, tmpbuf, 12, &n_read, BULK_TIMEOUT);
	if (ret) {
		return ret;
	}

	/* read data */
	ret = libusb_bulk_transfer(devh, 0x82, buf, rlen, &n_read, BULK_TIMEOUT);

	return ret;
}

int
tvwsdr_write_reg(uint16_t reg, uint16_t page, void *buf, uint16_t len) {
	int ret, n_read;
	uint16_t len_le;
	unsigned char tmpbuf[12] = {0};

	reg = htole16(reg);
	page = htole16(page);
	len_le = htole16(len);
	memcpy(tmpbuf + 0, &reg, 2);
	memcpy(tmpbuf + 2, &page, 2);
	memcpy(tmpbuf + 4, &len_le, 2);
	tmpbuf[7] |= (0 << 7);
	reg = ~reg;
	page = ~page;
	memcpy(tmpbuf + 8, &reg, 2);
	memcpy(tmpbuf + 10, &page, 2);

	/* write offset */
	ret = libusb_bulk_transfer(devh, 0x03, tmpbuf, 12, &n_read, BULK_TIMEOUT);
	if (ret) {
		return ret;
	}

	/* write data */
	ret = libusb_bulk_transfer(devh, 0x03, buf, len, &n_read, BULK_TIMEOUT);

	return ret;
}

int
tvwsdr_wait_bits(uint16_t reg, uint16_t page, uint32_t mask, uint32_t val, int msec, int loop) {
	int count;
	uint32_t rval;

	for(count = 0; count < loop; count++) {
		if (tvwsdr_read_reg(reg, page, &rval, sizeof(rval))) {
			return -1;
		}
		rval = le32toh(rval);
		if ((rval & mask) == val) {
			return 0;
		}
		tvwsdr_msleep(msec);
	}

	return -1;
}

void
dump_regs(uint16_t page, uint16_t start, uint16_t span) {
	uint16_t i, reg, regmax;
	unsigned char buf[16];

	reg = start; regmax = reg + span;
	do {
		tvwsdr_read_reg(reg, page, buf, (uint16_t)sizeof(buf));
		printf("%04x: ", reg);
		for(i = 0; i < sizeof(buf); i++) {
			printf("%02x", buf[i]);
		}
		printf("\n");
		fflush(stdout);

		reg += sizeof(buf);
	} while(reg && reg <= (regmax - sizeof(buf) + 1));
}

int
tvwsdr_run_reg_cmds(struct tvwsdr_reg_cmd *cmds) {
	int ret;
	size_t off = 0;
	uint32_t val;
	unsigned char buf[16];

	while(cmds[off].op != MAX_REG_OP) {
		switch(cmds[off].op) {
		case REG_READ:
			ret = tvwsdr_read_reg(cmds[off].reg, cmds[off].page, buf, 4);
			if (ret) {
				return ret;
			}
			memcpy(&val, buf, 4);
			val = le32toh(val);
			printf("R %04x/%04x %08x (%c %08x)\n",
				cmds[off].reg, cmds[off].page, cmds[off].val,
				val == cmds[off].val ? 'Y' : 'N', val);
			break;

		case REG_WRITE:
			val = htole32(cmds[off].val);
			memcpy(buf, &val, 4);
			ret = tvwsdr_write_reg(cmds[off].reg, cmds[off].page, buf, 4);
			if (ret) {
				return ret;
			}
			printf("W %04x/%04x %08x\n",
				cmds[off].reg, cmds[off].page, cmds[off].val);
			break;

		case REG_SLEEP:
			tvwsdr_msleep(cmds[off].val);
			break;

		case UC_READ:
			buf[0] = 0x00;
			buf[1] = cmds[off].reg & 0xff;
			buf[2] = cmds[off].reg >> 8;
			buf[3] = 0x40;
			ret = tvwsdr_write_reg(0x4400, 0x2000, buf, 4);
			if (ret) {
				return ret;
			}
			ret = tvwsdr_read_reg(0x4400, 0x2000, buf, 4);
			if (ret) {
				return ret;
			}
			val = buf[0] & 0xff;
			printf("uR %04x %02x (%c %02x)\n",
				cmds[off].reg, cmds[off].val & 0xff,
				val == cmds[off].val ? 'Y' : 'N', val & 0xff);
			break;

		case UC_WRITE:
			buf[0] = cmds[off].val & 0xff;
			buf[1] = cmds[off].reg & 0xff;
			buf[2] = cmds[off].reg >> 8;
			buf[3] = 0x80;
			ret = tvwsdr_write_reg(0x4400, 0x2000, buf, 4);
			if (ret) {
				return ret;
			}
			printf("uW %04x %02x\n",
				cmds[off].reg, cmds[off].val & 0xff);
			break;

		case E0_MAGIC:
			ret = tvwsdr_read_reg(0xe000, 0x1000, buf, 4);
			if (ret) {
				return ret;
			}
			val = htole32(cmds[off].val);
			memcpy(buf, &val, 4);
			memset(buf + 4, 0, 12);
			ret = tvwsdr_write_reg(0xe000, 0x1000, buf, 16);
			if (ret) {
				return ret;
			}
			printf("eW %08x%08x\n", 0, val);

			ret = tvwsdr_read_reg(0xe010, 0x1000, buf, 16);
			if (ret) {
				return ret;
			}
			printf("eR %08x%08x\n",
				*((uint32_t *)(buf + 4)), *((uint32_t *)buf));
			memset(buf, 0, 4);
			ret = tvwsdr_write_reg(0xe010, 0x1000, buf, 4);
			if (ret) {
				return ret;
			}

			break;

		default:
			break;
		}

		off++;
	}

	return 0;
}

int
tvwsdr_load_fw(const char *fn) {
	char *buf;
	int fd;
	size_t flen, fpos;
	ssize_t rret;
	struct stat fileinfo;
	uint16_t wlen;

	fd = open(fn, O_RDONLY);
	if (fd < 0) {
		warn("failed to open %s", fn);
		return -1;
	}

	if (fstat(fd, &fileinfo)) {
		warn("failed to stat fd");
		return -1;
	}

	if (fileinfo.st_size <= 0) {
		warnx("invalid file size");
		return -1;
	}

	flen = (size_t)fileinfo.st_size;
	if (NULL == (buf = malloc(flen))) {
		warn("failed to allocate file buffer");
		return -1;
	}

	rret = read(fd, buf, flen);
	if (rret < 0 || (size_t)rret != flen) {
		warn("failed to read file");
		free(buf);
		return -1;
	}

	for(fpos = 0; fpos < flen; fpos += 512) {
		if (flen < 512 || flen - 512 < fpos) {
			wlen = flen - fpos;
		}
		else {
			wlen = 512;
		}
		if (tvwsdr_write_reg((uint16_t)fpos, 0x1001, buf + fpos, wlen)) {
			warnx("failed firmware transfer at 0x%04x", (uint16_t)fpos);
			free(buf);
			return -1;
		}
		if (flen - fpos == 512) {
			/* according to the USB spec, we need to send a 0 byte packet
			 * to terminate the transmission
			 */
			/* FIXME */
		}
	}

	free(buf);

	return 0;
}

int
tvwsdr_read_i2c(unsigned char *outbuf, uint8_t len) {
	uint8_t addr, count;
	unsigned char ctrl[4], tmpbuf[4];

	/* address discovery? */
	ctrl[0] = 0xe7;
	ctrl[1] = 0x05;
	ctrl[2] = 0x11;
	ctrl[3] = 0x08;
	if (tvwsdr_write_reg(0x03e0, 0x2000, ctrl, 4)) {
		return -1;
	}

	memset(ctrl, 0, 4);
	if (tvwsdr_write_reg(0x03e4, 0x2000, ctrl, 4)) {
		return -1;
	}

	/* read discovered address? */
	if (tvwsdr_read_reg(0x03e0, 0x2000, ctrl, 4)) {
		return -1;
	}
	addr = (uint8_t)ctrl[0];
	if (tvwsdr_write_reg(0x03e0, 0x2000, ctrl, 4)) {
		return -1;
	}

	/* write transaction length */
	ctrl[0] = (unsigned char)(len > 30 ? 30 : len);
	ctrl[1] = 0x01;
	ctrl[2] = 0x00;
	ctrl[3] = 0x10;
	if (tvwsdr_write_reg(0x03e4, 0x2000, ctrl, 4)) {
		return -1;
	}

	/* write i2c address with "read" bit set */
	ctrl[0] = (unsigned char)addr | 0x01;
	ctrl[1] = ctrl[2] = ctrl[3] = 0x00;
	if (tvwsdr_write_reg(0x03e8, 0x2000, ctrl, 4)) {
		return -1;
	}

	if (tvwsdr_read_reg(0x03e0, 0x2000, ctrl, 4)) {
		return -1;
	}
	ctrl[1] |= 0x10;
	if (tvwsdr_write_reg(0x03e0, 0x2000, ctrl, 4)) {
		return -1;
	}

	/* wait for i2c ready? */
	if (tvwsdr_wait_bits(0x03e0, 0x2000, 0x1000, 0, 10, 100)) {
		return -1;
	}

	for(count = 0; count < len; count++) {
		if (count && count % 30 == 0) {
			/* ??? */
			if (tvwsdr_read_reg(0x03e0, 0x2000, ctrl, 4)) {
				return -1;
			}
			ctrl[1] &= ~0x01;
			if (tvwsdr_write_reg(0x03e0, 0x2000, ctrl, 4)) {
				return -1;
			}
			if (tvwsdr_wait_bits(0x03e0, 0x2000, 0x01, 0, 10, 100)) {
				return -1;
			}

			/* ??? */
			ctrl[1] |= 0x02;
			if (tvwsdr_write_reg(0x03e0, 0x2000, ctrl, 4)) {
				return -1;
			}

			/* ??? */
			if (tvwsdr_read_reg(0x03e4, 0x2000, ctrl, 4)) {
				return -1;
			}
			ctrl[1] &= ~0x01;
			if (tvwsdr_write_reg(0x03e4, 0x2000, ctrl, 4)) {
				return -1;
			}
			if (tvwsdr_wait_bits(0x03e4, 0x2000, 0x0100, 0, 10, 100)) {
				return -1;
			}

			/* write remaining length */
			ctrl[0] = (unsigned char)(len - count > 30 ? 30 : len - count);
			if (tvwsdr_write_reg(0x03e4, 0x2000, ctrl, 4)) {
				return -1;
			}

			/* ??? */
			if (tvwsdr_read_reg(0x03e0, 0x2000, ctrl, 4)) {
				return -1;
			}
			ctrl[1] |= 0x10;
			if (tvwsdr_write_reg(0x03e0, 0x2000, ctrl, 4)) {
				return -1;
			}
			if (tvwsdr_wait_bits(0x03e0, 0x2000, 0x1000, 0, 10, 100)) {
				return -1;
			}
		}

		if (tvwsdr_read_reg(0x03e8, 0x2000, tmpbuf, 4)) {
			return -1;
		}
		outbuf[count] = tmpbuf[0];
	}

	return 0;
}

int
tvwsdr_write_i2c(unsigned char *wrbuf, uint8_t len) {
	uint8_t addr, count;
	unsigned char ctrl[4], tmpbuf[4];

	/* address discovery? */
	ctrl[0] = 0xe7;
	ctrl[1] = 0x01;
	ctrl[2] = 0x11;
	ctrl[3] = 0x08;
	if (tvwsdr_write_reg(0x03e0, 0x2000, ctrl, 4)) {
		return -1;
	}

	/* ??? */
	memset(ctrl, 0, 4);
	if (tvwsdr_write_reg(0x03e4, 0x2000, ctrl, 4)) {
		return -1;
	}
	ctrl[3] = 0x10;
	if (tvwsdr_write_reg(0x03e4, 0x2000, ctrl, 4)) {
		return -1;
	}

	/* read discovered address? */
	if (tvwsdr_read_reg(0x03e0, 0x2000, ctrl, 4)) {
		return -1;
	}
	addr = (uint8_t)ctrl[0];
	if (len <= 29) {
		ctrl[1] |= 0x02;
	}
	if (tvwsdr_write_reg(0x03e0, 0x2000, ctrl, 4)) {
		return -1;
	}

	/* ??? */
	if (tvwsdr_read_reg(0x03e4, 0x2000, ctrl, 4)) {
		return -1;
	}
	ctrl[1] = 0x01;
	if (tvwsdr_write_reg(0x03e4, 0x2000, ctrl, 4)) {
		return -1;
	}
	if (tvwsdr_read_reg(0x03e4, 0x2000, ctrl, 4)) {
		return -1;
	}

	/* write transaction length */
	ctrl[0] = (unsigned char)(len > 29 ? 29 : len);
	if (tvwsdr_write_reg(0x03e4, 0x2000, ctrl, 4)) {
		return -1;
	}

	/* write chip address */
	memset(ctrl, 0, 4);
	ctrl[0] = (unsigned char)addr;
	if (tvwsdr_write_reg(0x03e8, 0x2000, ctrl, 4)) {
		return -1;
	}

	memset(tmpbuf, 0, 4);
	for(count = 0; count < len; count++) {
		if (count && count % 29 == 0) {
			/* ??? */
			if (tvwsdr_read_reg(0x03e0, 0x2000, ctrl, 4)) {
				return -1;
			}
			ctrl[1] |= 0x10;
			if (tvwsdr_write_reg(0x03e0, 0x2000, ctrl, 4)) {
				return -1;
			}
			if (tvwsdr_wait_bits(0x03e0, 0x2000, 0x1000, 0, 10, 100)) {
				return -1;
			}

			/* ??? */
			ctrl[0] |= 0x07;
			ctrl[1] = 0;
			if (tvwsdr_write_reg(0x03e0, 0x2000, ctrl, 4)) {
				return -1;
			}
			if (tvwsdr_read_reg(0x03e0, 0x2000, ctrl, 4)) {
				return -1;
			}
			ctrl[1] |= 0x02;
			if (tvwsdr_write_reg(0x03e0, 0x2000, ctrl, 4)) {
				return -1;
			}

			/* ??? */
			if (tvwsdr_read_reg(0x03e4, 0x2000, ctrl, 4)) {
				return -1;
			}
			ctrl[1] &= ~0x01;
			if (tvwsdr_write_reg(0x03e4, 0x2000, ctrl, 4)) {
				return -1;
			}
			if (tvwsdr_wait_bits(0x03e4, 0x2000, 0x0100, 0, 10, 100)) {
				return -1;
			}

			/* write remaining length */
			ctrl[0] = (unsigned char)(len - count > 29 ? 29 : len - count);
			if (tvwsdr_write_reg(0x03e4, 0x2000, ctrl, 4)) {
				return -1;
			}
		}

		tmpbuf[0] = wrbuf[count];
		if (tvwsdr_write_reg(0x03e8, 0x2000, tmpbuf, 4)) {
			return -1;
		}
	}

	/* ??? */
	if (tvwsdr_read_reg(0x03e0, 0x2000, ctrl, 4)) {
		return -1;
	}
	ctrl[1] |= 0x10;
	if (tvwsdr_write_reg(0x03e0, 0x2000, ctrl, 4)) {
		return -1;
	}
	/* wait for i2c ready? */
	if (tvwsdr_wait_bits(0x03e0, 0x2000, 0x1000, 0, 10, 100)) {
		return -1;
	}

	return 0;
}

/* This function takes advantage of the fact that subaddress 0 is never written.
 * Instead, the array position before the desired subaddress is swapped out with
 * the subaddress value and written according to the datasheet.  Afterwards, the
 * old value is restored.
 */
int
tvwsdr_write_tda18271(unsigned char *wrbuf, uint8_t startaddr, uint8_t endaddr) {
	int ret;
	uint8_t len;
	unsigned char tmp;

	len = endaddr - startaddr + 1;

	tmp = wrbuf[startaddr - 1];
	wrbuf[startaddr - 1] = (unsigned char)startaddr;
	ret = tvwsdr_write_i2c(wrbuf + startaddr - 1, len + 1);
	wrbuf[startaddr - 1] = tmp;

	return ret;
}

int
tvwsdr_init() {
	int ret;
	unsigned char buf[39];
	unsigned int i;

	printf("Running init 1...\n");
	ret = tvwsdr_run_reg_cmds(tvw_init1);
	if (ret) {
		printf("failed to init(1) device: %i\n", ret);
		return -1;
	}

	printf("Uploading first firmware...\n");
	ret = tvwsdr_load_fw("CTRLT507-fixed.bin");
	if (ret) {
		printf("failed to load firmware\n");
		return -1;
	}

	if (tvwsdr_read_reg(0x200c, 0x2000, buf, 4)) {
		printf("failed to read 0x200c\n");
		return -1;
	}
	if (tvwsdr_write_reg(0x200c, 0x2000, buf, 4)) {
		printf("failed to write 0x200c\n");
		return -1;
	}

	/* this register read doesn't follow the pattern of the rest... */
	if (tvwsdr_read_reg(0x0000, 0x8000, buf, 0)) {
		printf("failed to do odd register read\n");
		return -1;
	}

	printf("Running init 2...\n");
	ret = tvwsdr_run_reg_cmds(tvw_init2);
	if (ret) {
		printf("failed to init(2) device: %i\n", ret);
		return -1;
	}

	/* SPI? */

	/* switch to bAlternateSetting 1 */
	if (libusb_set_interface_alt_setting(devh, 0, 1)) {
		printf("failed to set alternate setting 1\n");
		return -1;
	}

	printf("Running init 3...\n");
	ret = tvwsdr_run_reg_cmds(tvw_init3);
	if (ret) {
		printf("failed to init(3) device: %i\n", ret);
		return -1;
	}

	printf("Uploading second firmware...\n");
	ret = tvwsdr_load_fw("T507.bin");
	if (ret) {
		printf("failed to load firmware\n");
		return -1;
	}

	/* XXX make into function */
	if (tvwsdr_read_reg(0xe000, 0x1000, buf, 4)) {
		printf("failed to read 0xe000\n");
		return -1;
	}

	// 0x1301000001001a8e0000000000000000 
	memset(buf, 0, sizeof(buf));
	buf[0] = 0x13;
	buf[1] = 0x01;
	buf[4] = 0x01;
	/* 0x8e1a is T507.bin fw size */
	buf[6] = 0x1a;
	buf[7] = 0x8e;
	if (tvwsdr_write_reg(0xe000, 0x1000, buf, 16)) {
		printf("failed to write 0xe000\n");
		return -1;
	}

	sleep(1);

	if (tvwsdr_read_reg(0xe010, 0x1000, buf, 16)) {
		printf("failed to read 0xe010\n");
		return -1;
	}

	memset(buf, 0, 4);
	if (tvwsdr_write_reg(0xe010, 0x1000, buf, 4)) {
		printf("failed to write 0xe010\n");
		return -1;
	}

	printf("Running init 4...\n");
	ret = tvwsdr_run_reg_cmds(tvw_init4);
	if (ret) {
		printf("failed to init(4) device: %i\n", ret);
		return -1;
	}

	/* tuner config over I2C */
	printf("Configuring tuner...\n");
	tda18271_attach(&fe, 0, NULL, NULL);
	if (tvwsdr_read_i2c(buf, sizeof(buf))) {
		printf("failed to read i2c data\n");
		return -1;
	}
	for(i = 0; i < sizeof(buf); i++) {
		printf("i2c[0x%02x] = 0x%02x\n", i, buf[i]);
	}

	printf("Running init 5...\n");
	ret = tvwsdr_run_reg_cmds(tvw_init5);
	if (ret) {
		printf("failed to init(5) device: %i\n", ret);
		return -1;
	}

	return 0;
}
